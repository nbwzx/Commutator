/*!
 * Commutator (https://github.com/nbwzx/commutator)
 * Copyright (c) 2022 Zixing Wang <zixingwang.cn@gmail.com>
 * Licensed under MIT (https://github.com/nbwzx/commutator/blob/main/LICENSE)
 */
"use strict";var commutator=function(){function r(r){var a,e,c,u,l=r.algorithm;Z=null!==(a=r.order)&&void 0!==a?a:R,T=null!==(e=r.initialReplace)&&void 0!==e?e:O,V=null!==(c=r.finalReplace)&&void 0!==c?c:j,Q=null!==(u=r.commute)&&void 0!==u?u:w,l=l.replace(/[‘]/gu,"'"),l=l.replace(/[’]/gu,"'"),l=l.replace(/\(/gu,""),l=l.replace(/\)/gu,""),l=l.replace(/（/gu,""),l=l.replace(/）/gu,""),l=l.replace(/\{/gu,""),l=l.replace(/\}/gu,""),l=l.replace(/\s/gu,""),l=l.split("").join(" "),l=l.replace(/【/gu,"["),l=l.replace(/】/gu,"]"),l=l.replace(/：/gu,":"),l=l.replace(/，/gu,","),l=l.replace(/: /gu,":"),l=l.replace(/, /gu,","),l=l.replace(/\[ /gu,"["),l=l.replace(/\] /gu,"]"),l=l.replace(/ :/gu,":"),l=l.replace(/ ,/gu,","),l=l.replace(/ \[/gu,"["),l=l.replace(/ \]/gu,"]"),l="[".concat(l.replace(/\+/gu,"]+["),"]"),l=l.replace(/\]\[/gu,"]+["),0===Z?(G=!0,Z=S):G=!1,z=Math.floor(Z/2)+1-Z,C=Math.floor(Z/2);var i=n(t(l));if("Lack left parenthesis."===i[0]||"Lack right parenthesis."===i[0])return i[0];var s=o(i);if(""===s)return"Empty input.";var p=d(f(s));return""===p?"Empty input.":p}function a(r){var a="+:,/[]";return a.indexOf(r)>-1}function t(r){for(var t=[r[0]],e=1;e<r.length;e++)a(r[e])||a(t.slice(-1)[0])?t.push(r[e]):t.push(t.pop()+r[e]);return t}function e(r){return":"===r?0:","===r?1:"/"===r?2:"+"===r?3:"["===r?4:"]"===r?5:-1}function n(r){for(var t=[],n=[],o=!1,c="";r.length>0;){var u=r.shift();if(a(u))if("]"===u){for(o=!1;n.length>0;){if(c=n.pop(),"["===c){o=!0;break}t.push(c)}if(!o)return["Lack left parenthesis."]}else{for(;n.length>0&&"["!==n.slice(-1)[0]&&e(u)<=e(n.slice(-1)[0]);)t.push(n.pop());n.push(u)}else t.push(u)}for(;n.length>0;){if(c=n.pop(),"["===c)return["Lack right parenthesis."];t.push(c)}return t}function o(r){for(var t,e=[];r.length>0;){var n=r.shift();if(a(n)){if(!(e.length>=2))return"";var o=e.pop(),u=e.pop();e.push(c(u,o,n))}else e.push(n)}return null!==(t=e[0])&&void 0!==t?t:""}function c(r,a,t){var e=[],n=[];switch(e=f(r),n=f(a),t){case"+":return d(e.concat(n));case":":return d(e.concat(n,m(e)));case",":return d(e.concat(n,m(e),m(n)));case"/":return d(e.concat(n,m(e),m(e),m(n),e));default:return d(e.concat(n))}}function u(r){var e=r;e="[".concat(e.replace(/\+/gu,"]+["),"]"),e=e.replace(/\]\[/gu,"]+[");for(var o=n(t(e)),c=[];o.length>0;){var u=o.shift();if(a(u)){var i=c.pop(),s=c.pop(),f=Number(s),p=Number(i);isNaN(f)&&(f=s.split(" ").length),isNaN(p)&&(p=i.split(" ").length),c.push(l(f,p,u).toString())}else c.push(u)}return Number(c[0])}function l(r,a,t){switch(t){case"+":return r+a+K;case":":return r+a;case",":return I*Math.max(r,a)+J*Math.min(r,a);default:return 1/0}}function i(r,a){return u(r)-u(a)}function s(r){var a,t,e,n,o,c,u,l,s,p,v,g=r.algorithm;Z=null!==(a=r.order)&&void 0!==a?a:R,H=null!==(t=r.outerBracket)&&void 0!==t?t:N,I=null!==(e=r.abMaxScore)&&void 0!==e?e:L,J=null!==(n=r.abMinScore)&&void 0!==n?n:x,K=null!==(o=r.addScore)&&void 0!==o?o:k,T=null!==(c=r.initialReplace)&&void 0!==c?c:O,V=null!==(u=r.finalReplace)&&void 0!==u?u:j,Q=null!==(l=r.commute)&&void 0!==l?l:w,P=null!==(s=r.fast)&&void 0!==s?s:F;var b=null!==(p=r.maxDepth)&&void 0!==p?p:B,m=null!==(v=r.limit)&&void 0!==v?v:D;if(A=[],""===g)return["Empty input."];var d=f(g);0===Z?(G=!0,Z=2*(q+2)):G=!1,z=Math.floor(Z/2)+1-Z,C=Math.floor(Z/2),d=M(d);var y=d.length;if(0===y)return["Empty input."];for(var S=0;S<y;S++){for(var W=0,X=0;X<y;X++)d[S].base===d[X].base&&(W+=d[X].amount);if(W%Z!=0)return["Not found."]}var Y=0,$=[];for(S=0;S<y-1;S++)E(d[S],d[S+1])&&($[Y]=S,Y+=1);var _=Math.pow(2,Y),rr=["Not found."],ar=!1,tr=0;tr=0===b?Math.floor((y-1)/3):b;for(var er=1;er<=tr;er++){for(S=0;S<_;S++){var nr=d.concat();for(X=0;X<Y;X++)0!=(S&1<<X)&&(nr=U(nr,$[X],$[X]+1));if(rr=h(nr,er,er),"Not found."!==rr[0]&&(ar=!0),P&&ar)return A}if(ar&&(er===b||0===b))return A.sort(i),0===m?A:A.slice(0,m)}return["Not found."]}function f(r){var a=r;if(a=a.replace(/\s+/giu,""),a=a.replace(/[‘]/gu,"'"),a=a.replace(/[’]/gu,"'"),""===a)return[];Object.keys(T).length>0&&(a=a.replace(/[A-Z]w/gu,function(r){return r.charAt(0).toLowerCase()}));for(var t="",e=0;e<a.length;e++)(a[e+1]<"0"||a[e+1]>"9")&&"'"!==a[e+1]?t="".concat(t+a[e]," "):t+=a[e];for(var e in T)for(var n=new RegExp(e,"gu"),o=T[e].replace(/[^a-zA-Z]/gu,"").split(""),c=0,u=o;c<u.length;c++){var l=u[c];t.indexOf(l)>-1&&(t=t.replace(n,T[e]))}var i=t.split(" "),s=[];for(e=0;e<i.length;e++){s[e]={base:i[e][0],amount:0};var f=i[e].replace(/[^0-9]/gu,"");s[e].amount=""===f?1:Number(f),s[e].amount>q&&(q=s[e].amount),i[e].indexOf("'")>-1&&(s[e].amount=-s[e].amount)}return s}function p(r,a,t){for(var e=0,n=[],o=0;o<r.length-1;o++)E(r[o],r[o+1])&&(n[e]=o,e+=1);var c=Math.pow(2,e),u=["Not found."];for(o=0;o<c;o++){for(var l=r.concat(),i=0;i<e;i++)0!=(o&1<<i)&&(l=U(l,n[i],n[i]+1));if(u=h(l,a,t),"Not found."!==u[0])return u}return["Not found."]}function h(r,a,t){var e=M(r),n="",o=e.concat(),c=e.length;if(e.length<3*a+1)return["Not found."];for(var l=0;l<=(c+e.length+1)/2-1;l++)for(var i=1;i<Z;i++){var s=(i%2*2-1)*Math.floor((i+1)/2);if(0===l){if(i>1)break}else{if(Math.abs(s)>Math.abs(o[l-1].amount))break;if((Z%2==1||o[l-1].amount!==Math.floor(Z/2))&&(o[l-1].amount<0&&s>0||o[l-1].amount>0&&s<0))continue}e=b(o,l,s);for(var f=1;f<=e.length/2-1;f++){var h=0;h=1===a?Math.max(1,Math.floor((e.length+1)/2-f)):1;for(var U=h;U<=e.length/2-1;U++){var S=[],R=[],N=[[]],L=[[]];if(e[f-1].base===e[f+U-1].base){for(var x=z;x<=C;x++)if(0!==x){var k=y(e[f+U-1].amount+x);S=M(v(e.slice(0,f),x)),N.push(S),R=M(m(S).concat(v(e.slice(0,f+U),k))),L.push(R)}}else{if(1===a&&e[f].base!==e[e.length-1].base)continue;S=M(e.slice(0,f)),N.push(S),R=M(e.slice(f,f+U)),L.push(R);var B=[];E(e[f-1],e[f+U-1])&&(N.push(S),B=M(R.concat([e[f-1]])),L.push(B),f>=2&&E(e[f-1],e[f-2])&&(N.push(S),B=M(R.concat(e.slice(f-2,f))),L.push(B))),E(e[f],e[f+U])&&(B=M(S.concat(m([e[f+U]]))),N.push(B),B=M([e[f+U]].concat(R)),L.push(B),e.length>=f+U+2&&E(e[f+U],e[f+U+1])&&(B=M(S.concat(m(e.slice(f+U,f+U+2)))),N.push(B),B=M(e.slice(f+U,f+U+2).concat(R)),L.push(B)))}for(var D=1;D<N.length;D++){S=N[D],R=L[D];var F=M(R.concat(S,m(R),m(S),e)),w="";if(a>1)w=p(F,a-1,t)[0];else if(F.length>0)continue;if("Not found."!==w){var O=S,j=R,q=M(R.concat(S));q.length<Math.max(S.length,R.length)&&(S.length<=R.length?(O=S,j=q):(O=m(R),j=q));var G=M(v(o.slice(0,l),s)),H=O,I=j;if(G.length>0&&1===t){var J=M(G.concat(j));J.length<G.length-1&&(G=J,H=m(j),I=O)}var K=d(H),Q=d(I),T=d(G);if(""===K||""===Q)continue;var V=g(T,K,Q,w);if(""===n&&(n=V),u(V)<u(n)&&(n=V),a===t&&-1===A.indexOf(V)&&A.push(V),P)return[n]}}}}}return""===n?["Not found."]:[n]}function v(r,a){var t=r.concat();if(0===t.length)return[];var e=t.pop();return 0===a?t:(t.push({base:e.base,amount:a}),t)}function g(r,a,t,e){return""===e?H?""===r?"[".concat(a,",").concat(t,"]"):"[".concat(r,":[").concat(a,",").concat(t,"]]"):""===r?"[".concat(a,",").concat(t,"]"):"".concat(r,":[").concat(a,",").concat(t,"]"):H?""===r?"[".concat(a,",").concat(t,"]").concat(e):"[".concat(r,":[").concat(a,",").concat(t,"]").concat(e,"]"):""===r?"[".concat(a,",").concat(t,"]+").concat(e):"".concat(r,":[[").concat(a,",").concat(t,"]+").concat(e,"]")}function b(r,a,t){var e=r.concat(),n=v(e.slice(0,a),t);return M(m(n).concat(e,n))}function m(r){for(var a=[],t=r.length-1;t>=0;t--)a.push({base:r[t].base,amount:y(-r[t].amount)});return a}function d(r){var a=r.concat();if(a=M(a),0===a.length)return"";for(var t=0;t<=1;t++)for(var e=0;e<a.length-1;e++)E(a[e],a[e+1])&&Q[a[e].base].priority>Q[a[e+1].base].priority&&(a=U(a,e,e+1));var n=[];for(e=0;e<a.length;e++)a[e].amount<0?-1===a[e].amount?n[e]="".concat(a[e].base,"'"):n[e]="".concat(a[e].base+-a[e].amount,"'"):1===a[e].amount?n[e]=a[e].base:n[e]=a[e].base+a[e].amount;var o="".concat(n.join(" ")," ");for(var e in V){var c=new RegExp("".concat(e," "),"gu");o=o.replace(c,"".concat(V[e]," "))}return o=o.substring(0,o.length-1),o}function M(r){if(0===r.length)return[];for(var a=[],t=0;t<r.length;t++){var e={base:r[t].base,amount:y(r[t].amount)},n=a.length;if(0!==y(e.amount)){for(var o=!1,c=1;c<=3;c++)if(a.length>=c&&a[n-c].base===e.base){var u=!0;if(c>=2){for(var l=1;l<=c;l++)if(!(a[n-l].base in Q)){u=!1;break}for(l=2;l<=c;l++)if(!E(a[n-l],a[n-(l-1)])){u=!1;break}}if(u){var i={base:a[n-c].base,amount:y(a[n-c].amount+e.amount)};0===i.amount?a.splice(-c,1):a.splice(-c,1,i),o=!0;break}}o||(a[n]=e)}}return a}function E(r,a){return r.base in Q&&a.base in Q&&Q[r.base].class===Q[a.base].class}function U(r,a,t){return r[a]=r.splice(t,1,r[a])[0],r}function y(r){return G?r:(r%Z+Z-z)%Z+z}var S=4294967295,R=4,N=!1,L=2.5,x=5,k=1,B=0,D=0,F=!1,w={U:{class:1,priority:1},u:{class:1,priority:2},E:{class:1,priority:3},D:{class:1,priority:4},d:{class:1,priority:5},R:{class:2,priority:1},r:{class:2,priority:2},M:{class:2,priority:3},L:{class:2,priority:4},l:{class:2,priority:5},F:{class:3,priority:1},f:{class:3,priority:2},S:{class:3,priority:3},B:{class:3,priority:4},b:{class:3,priority:5}},O={r2:"R2 M2","r'":"R' M",r:"R M'",l2:"M2 L2","l'":"M' L'",l:"M L",f2:"F2 S2","f'":"F' S'",f:"F S",b2:"S2 B2","b'":"S B'",b:"S' B",u2:"U2 E2","u'":"U' E",u:"U E'",d2:"E2 D2","d'":"E' D'",d:"E D"},j={"R2 M2":"r2","R' M":"r'","R M'":"r","M2 L2":"l2","M' L'":"l'","M L":"l","F2 S2":"f2","F' S'":"f'","F S":"f","S2 B2":"b2","S B'":"b'","S' B":"b","U2 E2":"u2","U' E":"u'","U E'":"u","E2 D2":"d2","E' D'":"d'","E D":"d","M2 R2":"r2","M R'":"r'","M' R":"r","L2 M2":"l2","L' M'":"l'","L M":"l","S2 F2":"f2","S' F'":"f'","S F":"f","B2 S2":"b2","B' S":"b'","B S'":"b","E2 U2":"u2","E U'":"u'","E' U":"u","D2 E2":"d2","D' E'":"d'","D E":"d","R M2":"r M'","R' M2":"r' M","M2 R":"r M'","M2 R'":"r' M","U2 E":"U' u'","U2 E'":"U u","E U2":"U' u'","E' U2":"U u","U E2":"U' u2","U' E2":"U u2","E2 U":"U' u2","E2 U'":"U u2"},A=[],Z=R,z=Math.floor(R/2)+1-R,C=Math.floor(R/2),q=0,G=!1,H=N,I=L,J=x,K=k,P=!1,Q=w,T=O,V=j;return{search:s,expand:r}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=commutator);