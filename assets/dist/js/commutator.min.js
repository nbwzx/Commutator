/*!
 * Commutator (https://github.com/nbwzx/commutator)
 * Copyright (c) 2022 Zixing Wang <zixingwang.cn@gmail.com>
 * Licensed under MIT (https://github.com/nbwzx/commutator/blob/main/LICENSE)
 */
"use strict";var commutator=function(){function a(a){var e,n,c,u,l=a.algorithm;w=Number(null!==(e=a.order)&&void 0!==e?e:N),I=null!==(n=a.initialReplace)&&void 0!==n?n:D,J=null!==(c=a.finalReplace)&&void 0!==c?c:F,H=null!==(u=a.commute)&&void 0!==u?u:B;var s=l;if(s=s.replace(/[‘]/gu,"'"),s=s.replace(/[’]/gu,"'"),s=s.replace(/\(/gu,""),s=s.replace(/\)/gu,""),s=s.replace(/（/gu,""),s=s.replace(/）/gu,""),s=s.replace(/\s/gu,""),s=s.split("").join(" "),s=s.replace(/【/gu,"["),s=s.replace(/】/gu,"]"),s=s.replace(/，/gu,","),s=s.replace(/: /gu,":"),s=s.replace(/, /gu,","),s=s.replace(/\[ /gu,"["),s=s.replace(/\] /gu,"]"),s=s.replace(/ :/gu,":"),s=s.replace(/ ,/gu,","),s=s.replace(/ \[/gu,"["),s=s.replace(/ \]/gu,"]"),s="[".concat(s.replace(/\+/gu,"]+["),"]"),s=s.replace(/\]\[/gu,"]+["),""===s)return"Empty input.";0===w&&(f(s),w=2*(z+2)),O=Math.floor(w/2)+1-w,j=Math.floor(w/2);var i=t(r(s));return"Lack left parenthesis."===i[0]||"Lack right parenthesis."===i[0]?i[0]:d(f(o(i)))}function e(a){var e="+:,[]";return e.indexOf(a)>-1}function r(a){var r=[];r.push(a[0]);for(var n=1;n<a.length;n++)e(a[n])||e(r.slice(-1)[0])?r.push(a[n]):r.push(r.pop()+a[n]);return r}function n(a){return","===a?0:":"===a?1:"+"===a?2:"["===a?3:"]"===a?4:-1}function t(a){for(var r,t,o,c,u=[],l=[],s=!1,i="";a.length>0;){var f=null!==(r=a.shift())&&void 0!==r?r:"";if(e(f))if(4===n(f)){for(s=!1;l.length>0;){if(i=null!==(t=l.pop())&&void 0!==t?t:"","["===i){s=!0;break}u.push(i)}if(!s)return["Lack left parenthesis."]}else{for(;l.length>0&&l.slice(-1).toString()!=="[".toString()&&n(f)<=n(l.slice(-1)[0]);)u.push(null!==(o=l.pop())&&void 0!==o?o:"");l.push(f)}else u.push(f)}for(;l.length>0;){if(i=null!==(c=l.pop())&&void 0!==c?c:"","["===i)return["Lack right parenthesis."];u.push(i)}return u}function o(a){for(var r,n,t,o="",u="",l=[];a.length>0;){var s=null!==(r=a.shift())&&void 0!==r?r:"";e(s)?(u=null!==(n=l.pop())&&void 0!==n?n:"",o=null!==(t=l.pop())&&void 0!==t?t:"",l.push(c(o,u,s))):l.push(s)}return l[0]}function c(a,e,r){var n=[],t=[];switch(n=f(a),t=f(e),r){case"+":return d(n.concat(t));case":":return d(n.concat(t,m(n)));case",":return d(n.concat(t,m(n),m(t)));default:return d(n.concat(t))}}function u(a){var n,o,c,u="",s="",i=a;i=i.replace(/\s/gu," "),i=i.replace(/\(/gu,"["),i=i.replace(/\)/gu,"]"),i=i.replace(/（/gu,"["),i=i.replace(/）/gu,"]"),i=i.replace(/【/gu,"["),i=i.replace(/】/gu,"]"),i=i.replace(/，/gu,","),i="[".concat(i.replace(/\+/gu,"]+["),"]"),i=i.replace(/\]\[/gu,"]+[");for(var f=t(r(i)),p=[];f.length>0;){var h=null!==(n=f.shift())&&void 0!==n?n:"";if(e(h)){s=null!==(o=p.pop())&&void 0!==o?o:"",u=null!==(c=p.pop())&&void 0!==c?c:"";var g=Number(u),v=Number(s);isNaN(g)&&(g=u.split(" ").length),isNaN(v)&&(v=s.split(" ").length),p.push(l(g,v,h).toString())}else p.push(h)}return Number(p[0])}function l(a,e,r){switch(r){case"+":case":":return a+e;case",":return Z*Math.max(a,e)+q*Math.min(a,e);default:return 1/0}}function s(a,e){return u(a)-u(e)}function i(a){var e,r,n,t,o,c,u,l,i,p=a.algorithm;if(w=Number(null!==(e=a.order)&&void 0!==e?e:N),A=null!==(r=a.outerBracket)&&void 0!==r?r:R,Z=Number(null!==(n=a.abMaxScore)&&void 0!==n?n:y),q=Number(null!==(t=a.abMinScore)&&void 0!==t?t:x),I=null!==(o=a.initialReplace)&&void 0!==o?o:D,J=null!==(c=a.finalReplace)&&void 0!==c?c:F,H=null!==(u=a.commute)&&void 0!==u?u:B,C=Number(null!==(l=a.maxDepth)&&void 0!==l?l:L),G=Number(null!==(i=a.limit)&&void 0!==i?i:k),U=[],""===p)return["Empty input."];var g=f(p);0===w&&(w=2*(z+2)),O=Math.floor(w/2)+1-w,j=Math.floor(w/2),g=M(g);var v=g.length;if(0===v)return["Empty input."];for(var b=0,m=0;m<=v-1;m++){b=0;for(var d=0;d<=v-1;d++)g[m].base===g[d].base&&(b+=g[d].amount);if(b%w!=0)return["Not found."]}var E=0,K=[];for(m=0;m<v-1;m++)g[m].base in H&&g[m+1].base in H&&H[g[m].base].class===H[g[m+1].base].class&&(K[E]=m,E+=1);var P=Math.pow(2,E),Q=["Not found."],T=!1,V=0;V=0===C?Math.floor((v-1)/3):C;for(var W=1;W<=V;W++){for(m=0;m<=P-1;m++){var X=String(m.toString(2)),Y=g.concat();for(d=0;d<X.length;d++)"1"===X[X.length-1-d]&&(Y=S(Y,K[d],K[d]+1));Q=h(Y,W,W),"Not found."!==Q[0]&&(T=!0)}if(T&&(W===C||0===C))return U.sort(s),0===G?U:U.slice(0,G)}return["Not found."]}function f(a){var e=a;if(e=e.replace(/\s+/giu,""),e=e.replace(/[‘]/gu,"'"),e=e.replace(/[’]/gu,"'"),""===e)return[];for(var r="",n=0;n<e.length;n++)(e[n+1]<"0"||e[n+1]>"9")&&"'"!==e[n+1]?r="".concat(r+e[n]," "):r+=e[n];for(var n in I)for(var t=new RegExp(n,"gu"),o=I[n].replace(/[^a-zA-Z]/gu,"").split(""),c=0,u=o;c<u.length;c++){var l=u[c];r.indexOf(l)>-1&&(r=r.replace(t,I[n]))}var s=r.split(" "),i=[];for(n=0;n<s.length;n++){i[n]={base:s[n][0],amount:0};var f=s[n].replace(/[^0-9]/gu,"");i[n].amount=""===f?1:Number(f),i[n].amount>z&&(z=i[n].amount),s[n].indexOf("'")>-1&&(i[n].amount=-i[n].amount)}return i}function p(a,e,r){for(var n=0,t=[],o=0;o<a.length-1;o++)a[o].base in H&&a[o+1].base in H&&H[a[o].base].class===H[a[o+1].base].class&&(t[n]=o,n+=1);var c=Math.pow(2,n),u=["Not found."];for(o=0;o<=c-1;o++){for(var l=String(o.toString(2)),s=a.concat(),i=0;i<l.length;i++)"1"===l[l.length-1-i]&&(s=S(s,t[i],t[i]+1));if(u=h(s,e,r),"Not found."!==u[0])return u}return["Not found."]}function h(a,e,r){var n=M(a),t="",o=n.concat(),c=n.length;if(n.length<3*e+1)return["Not found."];for(var l=0;l<=(c+n.length+1)/2-1;l++)for(var s=1;s<w;s++){var i=(s%2*2-1)*Math.floor((s+1)/2);if(0===l){if(s>1)break}else{if(Math.abs(i)>Math.abs(o[l-1].amount))break;if((w%2==1||o[l-1].amount!==Math.floor(w/2))&&(o[l-1].amount<0&&i>0||o[l-1].amount>0&&i<0))continue}n=b(o,l,i);for(var f=1;f<=n.length/2-1;f++){var h=0;h=1===e?Math.max(1,Math.ceil(n.length/2-f)):1;for(var S=h;S<=n.length/2-1;S++){var N=[],R=[],y=[[]],x=[[]];if(n[f-1].base===n[f+S-1].base){for(var L=O;L<=j;L++)if(0!==L){var k=E(n[f+S-1].amount+L);N=M(g(n.slice(0,f),L)),y.push(N),R=M(m(N).concat(g(n.slice(0,f+S),k))),x.push(R)}}else{if(1===e&&n[f].base!==n[n.length-1].base)continue;N=M(n.slice(0,f)),y.push(N),R=M(n.slice(f,f+S)),x.push(R);var B=[];n[f-1].base in H&&n[f+S-1].base in H&&H[n[f+S-1].base].class===H[n[f-1].base].class&&n[f+S-1].base!==n[f-1].base&&(y.push(N),B=M(R.concat([n[f-1]])),x.push(B),f>=2&&n[f-1].base in H&&n[f-2].base in H&&H[n[f-2].base].class===H[n[f-1].base].class&&(y.push(N),B=M(R.concat(n.slice(f-2,f))),x.push(B))),n[f].base in H&&n[f+S].base in H&&H[n[f+S].base].class===H[n[f].base].class&&n[f+S].base!==n[f].base&&(B=M(N.concat(m([n[f+S]]))),y.push(B),B=M([n[f+S]].concat(R)),x.push(B),n.length>=f+S+2&&n[f+S].base in H&&n[f+S+1].base in H&&H[n[f+S+1].base].class===H[n[f+S].base].class&&(B=M(N.concat(m(n.slice(f+S,f+S+2)))),y.push(B),B=M(n.slice(f+S,f+S+2).concat(R)),x.push(B)))}for(var D=1;D<y.length;D++){N=y[D],R=x[D];var F=M(R.concat(N,m(R),m(N),n)),z="";if(e>1)z=p(F,e-1,r)[0];else if(F.length>0)continue;if("Not found."!==z){var A=N,Z=R,q=M(R.concat(N));q.length<Math.max(N.length,R.length)&&(N.length<=R.length?(A=N,Z=q):(A=m(R),Z=q));var C=M(g(o.slice(0,l),i)),G=A,I=Z;if(C.length>0&&1===r){var J=M(C.concat(Z));J.length<C.length-1&&(C=J,G=m(Z),I=A)}var K=d(G),P=d(I),Q=d(C);if(""===K||""===P)continue;var T=v(Q,K,P,z);""===t&&(t=T),u(T)<u(t)&&(t=T),e===r&&-1===U.indexOf(T)&&U.push(T)}}}}}return""===t?["Not found."]:[t]}function g(a,e){var r,n=a.concat();if(0===n.length)return[];var t=null!==(r=n.pop())&&void 0!==r?r:{base:"",amount:0};return 0===e?n:(n.push({base:t.base,amount:e}),n)}function v(a,e,r,n){return""===n?A?""===a?"[".concat(e,",").concat(r,"]"):"[".concat(a,":[").concat(e,",").concat(r,"]]"):""===a?"[".concat(e,",").concat(r,"]"):"".concat(a,":[").concat(e,",").concat(r,"]"):A?""===a?"[".concat(e,",").concat(r,"]").concat(n):"[".concat(a,":[").concat(e,",").concat(r,"]").concat(n,"]"):""===a?"[".concat(e,",").concat(r,"]+").concat(n):"".concat(a,":[[").concat(e,",").concat(r,"]+").concat(n,"]")}function b(a,e,r){var n=a.concat(),t=g(n.slice(0,e),r);return M(m(t).concat(n,t))}function m(a){for(var e=[],r=a.length-1;r>=0;r--)e.push({base:a[r].base,amount:E(-a[r].amount)});return e}function d(a){var e=a.concat();if(e=M(e),0===e.length)return"";for(var r=0;r<=1;r++)for(var n=0;n<e.length-1;n++)e[n].base in H&&e[n+1].base in H&&H[e[n].base].class===H[e[n+1].base].class&&H[e[n].base].priority>H[e[n+1].base].priority&&(e=S(e,n,n+1));var t=[];for(n=0;n<e.length;n++)e[n].amount<0?-1===e[n].amount?t[n]="".concat(e[n].base,"'"):t[n]="".concat(e[n].base+-e[n].amount,"'"):1===e[n].amount?t[n]=e[n].base:t[n]=e[n].base+e[n].amount;var o="".concat(t.join(" ")," ");for(var n in J){var c=new RegExp("".concat(n," "),"gu");o=o.replace(c,"".concat(J[n]," "))}return o=o.substring(0,o.length-1),o}function M(a){if(0===a.length)return[];for(var e=[],r=0;r<a.length;r++){var n={base:a[r].base,amount:E(a[r].amount)},t=e.length;if(0!==E(n.amount)){for(var o=!1,c=1;c<=3;c++)if(e.length>=c&&e[t-c].base===n.base){var u=!0;if(c>=2){for(var l=1;l<=c;l++)if(!(e[t-l].base in H)){u=!1;break}for(l=2;l<=c;l++){if(!(e[t-l].base in H&&e[t-(l-1)].base in H)){u=!1;break}if(H[e[t-l].base].class!==H[e[t-(l-1)].base].class){u=!1;break}}}if(u){var s={base:e[t-c].base,amount:E(e[t-c].amount+n.amount)};0===s.amount?e.splice(-c,1):e.splice(-c,1,s),o=!0;break}}o||(e[t]=n)}}return e}function S(a,e,r){return a[e]=a.splice(r,1,a[e])[0],a}function E(a){return(a%w+w-O)%w+O}var N=4,R=!1,y=2.5,x=5,L=0,k=0,B={U:{class:1,priority:1},D:{class:1,priority:2},E:{class:1,priority:3},R:{class:2,priority:1},L:{class:2,priority:2},M:{class:2,priority:3},F:{class:3,priority:1},B:{class:3,priority:2},S:{class:3,priority:3}},D={r2:"R2 M2","r'":"R' M",r:"R M'",l2:"L2 M2","l'":"L' M'",l:"L M",f2:"F2 S2","f'":"F' S'",f:"F S",b2:"B2 S2","b'":"B' S",b:"B S'",u2:"U2 E2","u'":"U' E",u:"U E'",d2:"D2 E2","d'":"D' E'",d:"D E"},F={"R2 M2":"r2","R' M":"r'","R M'":"r","L2 M2":"l2","L' M'":"l'","L M":"l","F2 S2":"f2","F' S'":"f'","F S":"f","B2 S2":"b2","B' S":"b'","B S'":"b","U2 E2":"u2","U' E":"u'","U E'":"u","D2 E2":"d2","D' E'":"d'","D E":"d","M2 R2":"r2","M R'":"r'","M' R":"r","M2 L2":"l2","M' L'":"l'","M L":"l","S2 F2":"f2","S' F'":"f'","S F":"f","S2 B2":"b2","S B'":"b'","S' B":"b","E2 U2":"u2","E U'":"u'","E' U":"u","E2 D2":"d2","E' D'":"d'","E D":"d","R M2":"r M'","R' M2":"r' M","M2 R":"r M'","M2 R'":"r' M"},U=[],w=N,O=-1,j=2,z=0,A=R,Z=y,q=x,C=L,G=k,H=B,I=D,J=F;return{search:i,expand:a}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=commutator);