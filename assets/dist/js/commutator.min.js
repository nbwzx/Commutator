/*!
 * Commutator (https://github.com/nbwzx/commutator)
 * Copyright (c) 2022 Zixing Wang <zixingwang.cn@gmail.com>
 * Licensed under MIT (https://github.com/nbwzx/commutator/blob/main/LICENSE)
 */
"use strict";var commutator=function(){function r(r){var t,n,c,u,l=r.algorithm;if(j=null!==(t=r.order)&&void 0!==t?t:N,J=null!==(n=r.initialReplace)&&void 0!==n?n:U,K=null!==(c=r.finalReplace)&&void 0!==c?c:w,I=null!==(u=r.commute)&&void 0!==u?u:F,l=l.replace(/[‘]/gu,"'"),l=l.replace(/[’]/gu,"'"),l=l.replace(/\(/gu,""),l=l.replace(/\)/gu,""),l=l.replace(/（/gu,""),l=l.replace(/）/gu,""),l=l.replace(/\s/gu,""),l=l.split("").join(" "),l=l.replace(/【/gu,"["),l=l.replace(/】/gu,"]"),l=l.replace(/，/gu,","),l=l.replace(/: /gu,":"),l=l.replace(/, /gu,","),l=l.replace(/\[ /gu,"["),l=l.replace(/\] /gu,"]"),l=l.replace(/ :/gu,":"),l=l.replace(/ ,/gu,","),l=l.replace(/ \[/gu,"["),l=l.replace(/ \]/gu,"]"),l="[".concat(l.replace(/\+/gu,"]+["),"]"),l=l.replace(/\]\[/gu,"]+["),""===l)return"Empty input.";0===j&&(s(l),j=2*(Z+2)),z=Math.floor(j/2)+1-j,A=Math.floor(j/2);var i=e(a(l));return"Lack left parenthesis."===i[0]||"Lack right parenthesis."===i[0]?i[0]:d(s(o(i)))}function t(r){var t="+:,[]";return t.indexOf(r)>-1}function a(r){for(var a=[r[0]],n=1;n<r.length;n++)t(r[n])||t(a.slice(-1)[0])?a.push(r[n]):a.push(a.pop()+r[n]);return a}function n(r){return","===r?0:":"===r?1:"+"===r?2:"["===r?3:"]"===r?4:-1}function e(r){for(var a=[],e=[],o=!1,c="";r.length>0;){var u=r.shift();if(t(u))if(4===n(u)){for(o=!1;e.length>0;){if(c=e.pop(),"["===c){o=!0;break}a.push(c)}if(!o)return["Lack left parenthesis."]}else{for(;e.length>0&&"["!==e.slice(-1)[0]&&n(u)<=n(e.slice(-1)[0]);)a.push(e.pop());e.push(u)}else a.push(u)}for(;e.length>0;){if(c=e.pop(),"["===c)return["Lack right parenthesis."];a.push(c)}return a}function o(r){for(var a=[];r.length>0;){var n=r.shift();if(t(n)){var e=a.pop(),o=a.pop();a.push(c(o,e,n))}else a.push(n)}return a[0]}function c(r,t,a){var n=[],e=[];switch(n=s(r),e=s(t),a){case"+":return d(n.concat(e));case":":return d(n.concat(e,b(n)));case",":return d(n.concat(e,b(n),b(e)));default:return d(n.concat(e))}}function u(r){var n=r;n="[".concat(n.replace(/\+/gu,"]+["),"]"),n=n.replace(/\]\[/gu,"]+[");for(var o=e(a(n)),c=[];o.length>0;){var u=o.shift();if(t(u)){var i=c.pop(),f=c.pop(),s=Number(f),p=Number(i);isNaN(s)&&(s=f.split(" ").length),isNaN(p)&&(p=i.split(" ").length),c.push(l(s,p,u).toString())}else c.push(u)}return Number(c[0])}function l(r,t,a){switch(a){case"+":return r+t+H;case":":return r+t;case",":return C*Math.max(r,t)+G*Math.min(r,t);default:return 1/0}}function i(r,t){return u(r)-u(t)}function f(r){var t,a,n,e,o,c,u,l,f,p,g=r.algorithm;j=null!==(t=r.order)&&void 0!==t?t:N,q=null!==(a=r.outerBracket)&&void 0!==a?a:y,C=null!==(n=r.abMaxScore)&&void 0!==n?n:x,G=null!==(e=r.abMinScore)&&void 0!==e?e:L,H=null!==(o=r.addScore)&&void 0!==o?o:k,J=null!==(c=r.initialReplace)&&void 0!==c?c:U,K=null!==(u=r.finalReplace)&&void 0!==u?u:w,I=null!==(l=r.commute)&&void 0!==l?l:F;var v=null!==(f=r.maxDepth)&&void 0!==f?f:B,m=null!==(p=r.limit)&&void 0!==p?p:D;if(O=[],""===g)return["Empty input."];var b=s(g);0===j&&(j=2*(Z+2)),z=Math.floor(j/2)+1-j,A=Math.floor(j/2),b=M(b);var d=b.length;if(0===d)return["Empty input."];for(var R=0;R<d;R++){for(var P=0,Q=0;Q<d;Q++)b[R].base===b[Q].base&&(P+=b[Q].amount);if(P%j!=0)return["Not found."]}var T=0,V=[];for(R=0;R<d-1;R++)S(b[R],b[R+1])&&(V[T]=R,T+=1);var W=Math.pow(2,T),X=["Not found."],Y=!1,$=0;$=0===v?Math.floor((d-1)/3):v;for(var _=1;_<=$;_++){for(R=0;R<W;R++){var rr=String(R.toString(2)),tr=b.concat();for(Q=0;Q<rr.length;Q++)"1"===rr[rr.length-1-Q]&&(tr=E(tr,V[Q],V[Q]+1));X=h(tr,_,_),"Not found."!==X[0]&&(Y=!0)}if(Y&&(_===v||0===v))return O.sort(i),0===m?O:O.slice(0,m)}return["Not found."]}function s(r){var t=r;if(t=t.replace(/\s+/giu,""),t=t.replace(/[‘]/gu,"'"),t=t.replace(/[’]/gu,"'"),""===t)return[];for(var a="",n=0;n<t.length;n++)(t[n+1]<"0"||t[n+1]>"9")&&"'"!==t[n+1]?a="".concat(a+t[n]," "):a+=t[n];for(var n in J)for(var e=new RegExp(n,"gu"),o=J[n].replace(/[^a-zA-Z]/gu,"").split(""),c=0,u=o;c<u.length;c++){var l=u[c];a.indexOf(l)>-1&&(a=a.replace(e,J[n]))}var i=a.split(" "),f=[];for(n=0;n<i.length;n++){f[n]={base:i[n][0],amount:0};var s=i[n].replace(/[^0-9]/gu,"");f[n].amount=""===s?1:Number(s),f[n].amount>Z&&(Z=f[n].amount),i[n].indexOf("'")>-1&&(f[n].amount=-f[n].amount)}return f}function p(r,t,a){for(var n=0,e=[],o=0;o<r.length-1;o++)S(r[o],r[o+1])&&(e[n]=o,n+=1);var c=Math.pow(2,n),u=["Not found."];for(o=0;o<c;o++){for(var l=String(o.toString(2)),i=r.concat(),f=0;f<l.length;f++)"1"===l[l.length-1-f]&&(i=E(i,e[f],e[f]+1));if(u=h(i,t,a),"Not found."!==u[0])return u}return["Not found."]}function h(r,t,a){var n=M(r),e="",o=n.concat(),c=n.length;if(n.length<3*t+1)return["Not found."];for(var l=0;l<=(c+n.length+1)/2-1;l++)for(var i=1;i<j;i++){var f=(i%2*2-1)*Math.floor((i+1)/2);if(0===l){if(i>1)break}else{if(Math.abs(f)>Math.abs(o[l-1].amount))break;if((j%2==1||o[l-1].amount!==Math.floor(j/2))&&(o[l-1].amount<0&&f>0||o[l-1].amount>0&&f<0))continue}n=m(o,l,f);for(var s=1;s<=n.length/2-1;s++){var h=0;h=1===t?Math.max(1,Math.ceil(n.length/2-s)):1;for(var E=h;E<=n.length/2-1;E++){var N=[],y=[],x=[[]],L=[[]];if(n[s-1].base===n[s+E-1].base){for(var k=z;k<=A;k++)if(0!==k){var B=R(n[s+E-1].amount+k);N=M(g(n.slice(0,s),k)),x.push(N),y=M(b(N).concat(g(n.slice(0,s+E),B))),L.push(y)}}else{if(1===t&&n[s].base!==n[n.length-1].base)continue;N=M(n.slice(0,s)),x.push(N),y=M(n.slice(s,s+E)),L.push(y);var D=[];S(n[s-1],n[s+E-1])&&(x.push(N),D=M(y.concat([n[s-1]])),L.push(D),s>=2&&S(n[s-1],n[s-2])&&(x.push(N),D=M(y.concat(n.slice(s-2,s))),L.push(D))),S(n[s],n[s+E])&&(D=M(N.concat(b([n[s+E]]))),x.push(D),D=M([n[s+E]].concat(y)),L.push(D),n.length>=s+E+2&&S(n[s+E],n[s+E+1])&&(D=M(N.concat(b(n.slice(s+E,s+E+2)))),x.push(D),D=M(n.slice(s+E,s+E+2).concat(y)),L.push(D)))}for(var F=1;F<x.length;F++){N=x[F],y=L[F];var U=M(y.concat(N,b(y),b(N),n)),w="";if(t>1)w=p(U,t-1,a)[0];else if(U.length>0)continue;if("Not found."!==w){var Z=N,q=y,C=M(y.concat(N));C.length<Math.max(N.length,y.length)&&(N.length<=y.length?(Z=N,q=C):(Z=b(y),q=C));var G=M(g(o.slice(0,l),f)),H=Z,I=q;if(G.length>0&&1===a){var J=M(G.concat(q));J.length<G.length-1&&(G=J,H=b(q),I=Z)}var K=d(H),P=d(I),Q=d(G);if(""===K||""===P)continue;var T=v(Q,K,P,w);""===e&&(e=T),u(T)<u(e)&&(e=T),t===a&&-1===O.indexOf(T)&&O.push(T)}}}}}return""===e?["Not found."]:[e]}function g(r,t){var a=r.concat();if(0===a.length)return[];var n=a.pop();return 0===t?a:(a.push({base:n.base,amount:t}),a)}function v(r,t,a,n){return""===n?q?""===r?"[".concat(t,",").concat(a,"]"):"[".concat(r,":[").concat(t,",").concat(a,"]]"):""===r?"[".concat(t,",").concat(a,"]"):"".concat(r,":[").concat(t,",").concat(a,"]"):q?""===r?"[".concat(t,",").concat(a,"]").concat(n):"[".concat(r,":[").concat(t,",").concat(a,"]").concat(n,"]"):""===r?"[".concat(t,",").concat(a,"]+").concat(n):"".concat(r,":[[").concat(t,",").concat(a,"]+").concat(n,"]")}function m(r,t,a){var n=r.concat(),e=g(n.slice(0,t),a);return M(b(e).concat(n,e))}function b(r){for(var t=[],a=r.length-1;a>=0;a--)t.push({base:r[a].base,amount:R(-r[a].amount)});return t}function d(r){var t=r.concat();if(t=M(t),0===t.length)return"";for(var a=0;a<=1;a++)for(var n=0;n<t.length-1;n++)S(t[n],t[n+1])&&I[t[n].base].priority>I[t[n+1].base].priority&&(t=E(t,n,n+1));var e=[];for(n=0;n<t.length;n++)t[n].amount<0?-1===t[n].amount?e[n]="".concat(t[n].base,"'"):e[n]="".concat(t[n].base+-t[n].amount,"'"):1===t[n].amount?e[n]=t[n].base:e[n]=t[n].base+t[n].amount;var o="".concat(e.join(" ")," ");for(var n in K){var c=new RegExp("".concat(n," "),"gu");o=o.replace(c,"".concat(K[n]," "))}return o=o.substring(0,o.length-1),o}function M(r){if(0===r.length)return[];for(var t=[],a=0;a<r.length;a++){var n={base:r[a].base,amount:R(r[a].amount)},e=t.length;if(0!==R(n.amount)){for(var o=!1,c=1;c<=3;c++)if(t.length>=c&&t[e-c].base===n.base){var u=!0;if(c>=2){for(var l=1;l<=c;l++)if(!(t[e-l].base in I)){u=!1;break}for(l=2;l<=c;l++)if(!S(t[e-l],t[e-(l-1)])){u=!1;break}}if(u){var i={base:t[e-c].base,amount:R(t[e-c].amount+n.amount)};0===i.amount?t.splice(-c,1):t.splice(-c,1,i),o=!0;break}}o||(t[e]=n)}}return t}function S(r,t){return r.base in I&&t.base in I&&I[r.base].class===I[t.base].class}function E(r,t,a){return r[t]=r.splice(a,1,r[t])[0],r}function R(r){return(r%j+j-z)%j+z}var N=4,y=!1,x=2.5,L=5,k=1,B=0,D=0,F={U:{class:1,priority:1},D:{class:1,priority:2},E:{class:1,priority:3},R:{class:2,priority:1},L:{class:2,priority:2},M:{class:2,priority:3},F:{class:3,priority:1},B:{class:3,priority:2},S:{class:3,priority:3}},U={r2:"R2 M2","r'":"R' M",r:"R M'",l2:"L2 M2","l'":"L' M'",l:"L M",f2:"F2 S2","f'":"F' S'",f:"F S",b2:"B2 S2","b'":"B' S",b:"B S'",u2:"U2 E2","u'":"U' E",u:"U E'",d2:"D2 E2","d'":"D' E'",d:"D E"},w={"R2 M2":"r2","R' M":"r'","R M'":"r","L2 M2":"l2","L' M'":"l'","L M":"l","F2 S2":"f2","F' S'":"f'","F S":"f","B2 S2":"b2","B' S":"b'","B S'":"b","U2 E2":"u2","U' E":"u'","U E'":"u","D2 E2":"d2","D' E'":"d'","D E":"d","M2 R2":"r2","M R'":"r'","M' R":"r","M2 L2":"l2","M' L'":"l'","M L":"l","S2 F2":"f2","S' F'":"f'","S F":"f","S2 B2":"b2","S B'":"b'","S' B":"b","E2 U2":"u2","E U'":"u'","E' U":"u","E2 D2":"d2","E' D'":"d'","E D":"d","R M2":"r M'","R' M2":"r' M","M2 R":"r M'","M2 R'":"r' M"},O=[],j=N,z=Math.floor(N/2)+1-N,A=Math.floor(N/2),Z=0,q=y,C=x,G=L,H=k,I=F,J=U,K=w;return{search:f,expand:r}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=commutator);