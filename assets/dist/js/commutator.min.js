/*!
 * Commutator (https://github.com/nbwzx/commutator)
 * Copyright (c) 2022 Zixing Wang <zixingwang.cn@gmail.com>
 * Licensed under MIT (https://github.com/nbwzx/commutator/blob/main/LICENSE)
 */
"use strict";var commutator=function(){function a(a){var e,n,c,u,s=a.algorithm;w=null!==(e=a.order)&&void 0!==e?e:R,G=null!==(n=a.initialReplace)&&void 0!==n?n:D,H=null!==(c=a.finalReplace)&&void 0!==c?c:F,C=null!==(u=a.commute)&&void 0!==u?u:B;var l=s;if(l=l.replace(/[‘]/gu,"'"),l=l.replace(/[’]/gu,"'"),l=l.replace(/\(/gu,""),l=l.replace(/\)/gu,""),l=l.replace(/（/gu,""),l=l.replace(/）/gu,""),l=l.replace(/\s/gu,""),l=l.split("").join(" "),l=l.replace(/【/gu,"["),l=l.replace(/】/gu,"]"),l=l.replace(/，/gu,","),l=l.replace(/: /gu,":"),l=l.replace(/, /gu,","),l=l.replace(/\[ /gu,"["),l=l.replace(/\] /gu,"]"),l=l.replace(/ :/gu,":"),l=l.replace(/ ,/gu,","),l=l.replace(/ \[/gu,"["),l=l.replace(/ \]/gu,"]"),l="[".concat(l.replace(/\+/gu,"]+["),"]"),l=l.replace(/\]\[/gu,"]+["),""===l)return"Empty input.";0===w&&(f(l),w=2*(z+2)),O=Math.floor(w/2)+1-w,j=Math.floor(w/2);var i=t(r(l));return"Lack left parenthesis."===i[0]||"Lack right parenthesis."===i[0]?i[0]:d(f(o(i)))}function e(a){var e="+:,[]";return e.indexOf(a)>-1}function r(a){var r=[];r.push(a[0]);for(var n=1;n<a.length;n++)e(a[n])||e(r.slice(-1)[0])?r.push(a[n]):r.push(r.pop()+a[n]);return r}function n(a){return","===a?0:":"===a?1:"+"===a?2:"["===a?3:"]"===a?4:-1}function t(a){for(var r=[],t=[],o=!1,c="";a.length>0;){var u=a.shift();if(e(u))if(4===n(u)){for(o=!1;t.length>0;){if(c=t.pop(),"["===c){o=!0;break}r.push(c)}if(!o)return["Lack left parenthesis."]}else{for(;t.length>0&&"["!==t.slice(-1)[0]&&n(u)<=n(t.slice(-1)[0]);)r.push(t.pop());t.push(u)}else r.push(u)}for(;t.length>0;){if(c=t.pop(),"["===c)return["Lack right parenthesis."];r.push(c)}return r}function o(a){for(var r=[];a.length>0;){var n=a.shift();if(e(n)){var t=r.pop(),o=r.pop();r.push(c(o,t,n))}else r.push(n)}return r[0]}function c(a,e,r){var n=[],t=[];switch(n=f(a),t=f(e),r){case"+":return d(n.concat(t));case":":return d(n.concat(t,m(n)));case",":return d(n.concat(t,m(n),m(t)));default:return d(n.concat(t))}}function u(a){var n=a;n="[".concat(n.replace(/\+/gu,"]+["),"]"),n=n.replace(/\]\[/gu,"]+[");for(var o=t(r(n)),c=[];o.length>0;){var u=o.shift();if(e(u)){var l=c.pop(),i=c.pop(),f=Number(i),p=Number(l);isNaN(f)&&(f=i.split(" ").length),isNaN(p)&&(p=l.split(" ").length),c.push(s(f,p,u).toString())}else c.push(u)}return Number(c[0])}function s(a,e,r){switch(r){case"+":case":":return a+e;case",":return Z*Math.max(a,e)+q*Math.min(a,e);default:return 1/0}}function l(a,e){return u(a)-u(e)}function i(a){var e,r,n,t,o,c,u,s,i,p=a.algorithm;w=null!==(e=a.order)&&void 0!==e?e:R,A=null!==(r=a.outerBracket)&&void 0!==r?r:N,Z=null!==(n=a.abMaxScore)&&void 0!==n?n:y,q=null!==(t=a.abMinScore)&&void 0!==t?t:x,G=null!==(o=a.initialReplace)&&void 0!==o?o:D,H=null!==(c=a.finalReplace)&&void 0!==c?c:F,C=null!==(u=a.commute)&&void 0!==u?u:B;var g=null!==(s=a.maxDepth)&&void 0!==s?s:L,v=null!==(i=a.limit)&&void 0!==i?i:k;if(U=[],""===p)return["Empty input."];var b=f(p);0===w&&(w=2*(z+2)),O=Math.floor(w/2)+1-w,j=Math.floor(w/2),b=M(b);var m=b.length;if(0===m)return["Empty input."];for(var d=0;d<=m-1;d++){for(var E=0,I=0;I<=m-1;I++)b[d].base===b[I].base&&(E+=b[I].amount);if(E%w!=0)return["Not found."]}var J=0,K=[];for(d=0;d<m-1;d++)b[d].base in C&&b[d+1].base in C&&C[b[d].base].class===C[b[d+1].base].class&&(K[J]=d,J+=1);var P=Math.pow(2,J),Q=["Not found."],T=!1,V=0;V=0===g?Math.floor((m-1)/3):g;for(var W=1;W<=V;W++){for(d=0;d<=P-1;d++){var X=String(d.toString(2)),Y=b.concat();for(I=0;I<X.length;I++)"1"===X[X.length-1-I]&&(Y=S(Y,K[I],K[I]+1));Q=h(Y,W,W),"Not found."!==Q[0]&&(T=!0)}if(T&&(W===g||0===g))return U.sort(l),0===v?U:U.slice(0,v)}return["Not found."]}function f(a){var e=a;if(e=e.replace(/\s+/giu,""),e=e.replace(/[‘]/gu,"'"),e=e.replace(/[’]/gu,"'"),""===e)return[];for(var r="",n=0;n<e.length;n++)(e[n+1]<"0"||e[n+1]>"9")&&"'"!==e[n+1]?r="".concat(r+e[n]," "):r+=e[n];for(var n in G)for(var t=new RegExp(n,"gu"),o=G[n].replace(/[^a-zA-Z]/gu,"").split(""),c=0,u=o;c<u.length;c++){var s=u[c];r.indexOf(s)>-1&&(r=r.replace(t,G[n]))}var l=r.split(" "),i=[];for(n=0;n<l.length;n++){i[n]={base:l[n][0],amount:0};var f=l[n].replace(/[^0-9]/gu,"");i[n].amount=""===f?1:Number(f),i[n].amount>z&&(z=i[n].amount),l[n].indexOf("'")>-1&&(i[n].amount=-i[n].amount)}return i}function p(a,e,r){for(var n=0,t=[],o=0;o<a.length-1;o++)a[o].base in C&&a[o+1].base in C&&C[a[o].base].class===C[a[o+1].base].class&&(t[n]=o,n+=1);var c=Math.pow(2,n),u=["Not found."];for(o=0;o<=c-1;o++){for(var s=String(o.toString(2)),l=a.concat(),i=0;i<s.length;i++)"1"===s[s.length-1-i]&&(l=S(l,t[i],t[i]+1));if(u=h(l,e,r),"Not found."!==u[0])return u}return["Not found."]}function h(a,e,r){var n=M(a),t="",o=n.concat(),c=n.length;if(n.length<3*e+1)return["Not found."];for(var s=0;s<=(c+n.length+1)/2-1;s++)for(var l=1;l<w;l++){var i=(l%2*2-1)*Math.floor((l+1)/2);if(0===s){if(l>1)break}else{if(Math.abs(i)>Math.abs(o[s-1].amount))break;if((w%2==1||o[s-1].amount!==Math.floor(w/2))&&(o[s-1].amount<0&&i>0||o[s-1].amount>0&&i<0))continue}n=b(o,s,i);for(var f=1;f<=n.length/2-1;f++){var h=0;h=1===e?Math.max(1,Math.ceil(n.length/2-f)):1;for(var S=h;S<=n.length/2-1;S++){var R=[],N=[],y=[[]],x=[[]];if(n[f-1].base===n[f+S-1].base){for(var L=O;L<=j;L++)if(0!==L){var k=E(n[f+S-1].amount+L);R=M(g(n.slice(0,f),L)),y.push(R),N=M(m(R).concat(g(n.slice(0,f+S),k))),x.push(N)}}else{if(1===e&&n[f].base!==n[n.length-1].base)continue;R=M(n.slice(0,f)),y.push(R),N=M(n.slice(f,f+S)),x.push(N);var B=[];n[f-1].base in C&&n[f+S-1].base in C&&C[n[f+S-1].base].class===C[n[f-1].base].class&&n[f+S-1].base!==n[f-1].base&&(y.push(R),B=M(N.concat([n[f-1]])),x.push(B),f>=2&&n[f-1].base in C&&n[f-2].base in C&&C[n[f-2].base].class===C[n[f-1].base].class&&(y.push(R),B=M(N.concat(n.slice(f-2,f))),x.push(B))),n[f].base in C&&n[f+S].base in C&&C[n[f+S].base].class===C[n[f].base].class&&n[f+S].base!==n[f].base&&(B=M(R.concat(m([n[f+S]]))),y.push(B),B=M([n[f+S]].concat(N)),x.push(B),n.length>=f+S+2&&n[f+S].base in C&&n[f+S+1].base in C&&C[n[f+S+1].base].class===C[n[f+S].base].class&&(B=M(R.concat(m(n.slice(f+S,f+S+2)))),y.push(B),B=M(n.slice(f+S,f+S+2).concat(N)),x.push(B)))}for(var D=1;D<y.length;D++){R=y[D],N=x[D];var F=M(N.concat(R,m(N),m(R),n)),z="";if(e>1)z=p(F,e-1,r)[0];else if(F.length>0)continue;if("Not found."!==z){var A=R,Z=N,q=M(N.concat(R));q.length<Math.max(R.length,N.length)&&(R.length<=N.length?(A=R,Z=q):(A=m(N),Z=q));var G=M(g(o.slice(0,s),i)),H=A,I=Z;if(G.length>0&&1===r){var J=M(G.concat(Z));J.length<G.length-1&&(G=J,H=m(Z),I=A)}var K=d(H),P=d(I),Q=d(G);if(""===K||""===P)continue;var T=v(Q,K,P,z);""===t&&(t=T),u(T)<u(t)&&(t=T),e===r&&-1===U.indexOf(T)&&U.push(T)}}}}}return""===t?["Not found."]:[t]}function g(a,e){var r=a.concat();if(0===r.length)return[];var n=r.pop();return 0===e?r:(r.push({base:n.base,amount:e}),r)}function v(a,e,r,n){return""===n?A?""===a?"[".concat(e,",").concat(r,"]"):"[".concat(a,":[").concat(e,",").concat(r,"]]"):""===a?"[".concat(e,",").concat(r,"]"):"".concat(a,":[").concat(e,",").concat(r,"]"):A?""===a?"[".concat(e,",").concat(r,"]").concat(n):"[".concat(a,":[").concat(e,",").concat(r,"]").concat(n,"]"):""===a?"[".concat(e,",").concat(r,"]+").concat(n):"".concat(a,":[[").concat(e,",").concat(r,"]+").concat(n,"]")}function b(a,e,r){var n=a.concat(),t=g(n.slice(0,e),r);return M(m(t).concat(n,t))}function m(a){for(var e=[],r=a.length-1;r>=0;r--)e.push({base:a[r].base,amount:E(-a[r].amount)});return e}function d(a){var e=a.concat();if(e=M(e),0===e.length)return"";for(var r=0;r<=1;r++)for(var n=0;n<e.length-1;n++)e[n].base in C&&e[n+1].base in C&&C[e[n].base].class===C[e[n+1].base].class&&C[e[n].base].priority>C[e[n+1].base].priority&&(e=S(e,n,n+1));var t=[];for(n=0;n<e.length;n++)e[n].amount<0?-1===e[n].amount?t[n]="".concat(e[n].base,"'"):t[n]="".concat(e[n].base+-e[n].amount,"'"):1===e[n].amount?t[n]=e[n].base:t[n]=e[n].base+e[n].amount;var o="".concat(t.join(" ")," ");for(var n in H){var c=new RegExp("".concat(n," "),"gu");o=o.replace(c,"".concat(H[n]," "))}return o=o.substring(0,o.length-1),o}function M(a){if(0===a.length)return[];for(var e=[],r=0;r<a.length;r++){var n={base:a[r].base,amount:E(a[r].amount)},t=e.length;if(0!==E(n.amount)){for(var o=!1,c=1;c<=3;c++)if(e.length>=c&&e[t-c].base===n.base){var u=!0;if(c>=2){for(var s=1;s<=c;s++)if(!(e[t-s].base in C)){u=!1;break}for(s=2;s<=c;s++){if(!(e[t-s].base in C&&e[t-(s-1)].base in C)){u=!1;break}if(C[e[t-s].base].class!==C[e[t-(s-1)].base].class){u=!1;break}}}if(u){var l={base:e[t-c].base,amount:E(e[t-c].amount+n.amount)};0===l.amount?e.splice(-c,1):e.splice(-c,1,l),o=!0;break}}o||(e[t]=n)}}return e}function S(a,e,r){return a[e]=a.splice(r,1,a[e])[0],a}function E(a){return(a%w+w-O)%w+O}var R=4,N=!1,y=2.5,x=5,L=0,k=0,B={U:{class:1,priority:1},D:{class:1,priority:2},E:{class:1,priority:3},R:{class:2,priority:1},L:{class:2,priority:2},M:{class:2,priority:3},F:{class:3,priority:1},B:{class:3,priority:2},S:{class:3,priority:3}},D={r2:"R2 M2","r'":"R' M",r:"R M'",l2:"L2 M2","l'":"L' M'",l:"L M",f2:"F2 S2","f'":"F' S'",f:"F S",b2:"B2 S2","b'":"B' S",b:"B S'",u2:"U2 E2","u'":"U' E",u:"U E'",d2:"D2 E2","d'":"D' E'",d:"D E"},F={"R2 M2":"r2","R' M":"r'","R M'":"r","L2 M2":"l2","L' M'":"l'","L M":"l","F2 S2":"f2","F' S'":"f'","F S":"f","B2 S2":"b2","B' S":"b'","B S'":"b","U2 E2":"u2","U' E":"u'","U E'":"u","D2 E2":"d2","D' E'":"d'","D E":"d","M2 R2":"r2","M R'":"r'","M' R":"r","M2 L2":"l2","M' L'":"l'","M L":"l","S2 F2":"f2","S' F'":"f'","S F":"f","S2 B2":"b2","S B'":"b'","S' B":"b","E2 U2":"u2","E U'":"u'","E' U":"u","E2 D2":"d2","E' D'":"d'","E D":"d","R M2":"r M'","R' M2":"r' M","M2 R":"r M'","M2 R'":"r' M"},U=[],w=R,O=Math.floor(R/2)+1-R,j=Math.floor(R/2),z=0,A=N,Z=y,q=x,C=B,G=D,H=F;return{search:i,expand:a}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=commutator);