/*!
 * Commutator (https://github.com/nbwzx/commutator)
 * Copyright (c) 2022 Zixing Wang <zixingwang.cn@gmail.com>
 * Licensed under MIT (https://github.com/nbwzx/commutator/blob/main/LICENSE)
 */
"use strict";var commutator=function(){function r(r){var n,t,o,l,u=r.algorithm;w=Number(null!==(n=r.order)&&void 0!==n?n:N),I=null!==(t=r.initialReplace)&&void 0!==t?t:D,J=null!==(o=r.finalReplace)&&void 0!==o?o:F,H=null!==(l=r.commute)&&void 0!==l?l:B;var i=u;if(i=i.replace(/[‘]/gu,"'"),i=i.replace(/[’]/gu,"'"),i=i.replace(/\(/gu,""),i=i.replace(/\)/gu,""),i=i.replace(/（/gu,""),i=i.replace(/）/gu,""),i=i.replace(/\s/gu,""),i=i.split("").join(" "),i=i.replace(/【/gu,"["),i=i.replace(/】/gu,"]"),i=i.replace(/，/gu,","),i=i.replace(/: /gu,":"),i=i.replace(/, /gu,","),i=i.replace(/\[ /gu,"["),i=i.replace(/\] /gu,"]"),i=i.replace(/ :/gu,":"),i=i.replace(/ ,/gu,","),i=i.replace(/ \[/gu,"["),i=i.replace(/ \]/gu,"]"),i="[".concat(i.replace(/\+/gu,"]+["),"]"),i=i.replace(/\]\[/gu,"]+["),""===i)return"Empty input.";0===w&&(f(i),w=2*(z+2)),O=Math.floor(w/2)+1-w,j=Math.floor(w/2);var s=a(e(i));return"Lack left parenthesis."===s[0]||"Lack right parenthesis."===s[0]?s[0]:m(f(c(s)))}function n(r){var n="+:,[]";return n.indexOf(r)>-1}function e(r){var e=[];e.push(r[0]);for(var t=1;t<r.length;t++)n(r[t])||n(e.slice(-1)[0])?e.push(r[t]):e.push(e.pop()+r[t]);return e}function t(r){return","===r?0:":"===r?1:"+"===r?2:"["===r?3:"]"===r?4:-1}function a(r){for(var e,a,c,o,l=[],u=[],i=!1,s="";r.length>0;){var f=null!==(e=r.shift())&&void 0!==e?e:"";if(n(f))if(4===t(f)){for(i=!1;u.length>0;){if(s=null!==(a=u.pop())&&void 0!==a?a:"","["===s){i=!0;break}l.push(s)}if(!i)return["Lack left parenthesis."]}else{for(;u.length>0&&u.slice(-1).toString()!=="[".toString()&&t(f)<=t(u.slice(-1)[0]);)l.push(null!==(c=u.pop())&&void 0!==c?c:"");u.push(f)}else l.push(f)}for(;u.length>0;){if(s=null!==(o=u.pop())&&void 0!==o?o:"","["===s)return["Lack right parenthesis."];l.push(s)}return l}function c(r){for(var e,t,a,c="",l="",u=[];r.length>0;){var i=null!==(e=r.shift())&&void 0!==e?e:"";n(i)?(l=null!==(t=u.pop())&&void 0!==t?t:"",c=null!==(a=u.pop())&&void 0!==a?a:"",u.push(o(c,l,i))):u.push(i)}return u[0]}function o(r,n,e){var t=[],a=[];switch(t=f(r),a=f(n),e){case"+":return m(t.concat(a));case":":return m(t.concat(a,M(t)));case",":return m(t.concat(a,M(t),M(a)));default:return m(t.concat(a))}}function l(r){var t,c,o,l="",i="",s=r;s=s.replace(/\s/gu," "),s=s.replace(/\(/gu,"["),s=s.replace(/\)/gu,"]"),s=s.replace(/（/gu,"["),s=s.replace(/）/gu,"]"),s=s.replace(/【/gu,"["),s=s.replace(/】/gu,"]"),s=s.replace(/，/gu,","),s="[".concat(s.replace(/\+/gu,"]+["),"]"),s=s.replace(/\]\[/gu,"]+[");for(var f=a(e(s)),p=[];f.length>0;){var h=null!==(t=f.shift())&&void 0!==t?t:"";if(n(h)){i=null!==(c=p.pop())&&void 0!==c?c:"",l=null!==(o=p.pop())&&void 0!==o?o:"";var g=Number(l),v=Number(i);isNaN(g)&&(g=l.split(" ").length),isNaN(v)&&(v=i.split(" ").length),p.push(u(g,v,h).toString())}else p.push(h)}return Number(p[0])}function u(r,n,e){switch(e){case"+":case":":return r+n;case",":return Z*Math.max(r,n)+q*Math.min(r,n);default:return 1/0}}function i(r,n){return l(r)-l(n)}function s(r){var n,e,t,a,c,o,l,u,s,p=r.algorithm;if(w=Number(null!==(n=r.order)&&void 0!==n?n:N),A=null!==(e=r.outerBracket)&&void 0!==e?e:R,Z=Number(null!==(t=r.abMaxScore)&&void 0!==t?t:y),q=Number(null!==(a=r.abMinScore)&&void 0!==a?a:x),I=null!==(c=r.initialReplace)&&void 0!==c?c:D,J=null!==(o=r.finalReplace)&&void 0!==o?o:F,H=null!==(l=r.commute)&&void 0!==l?l:B,C=Number(null!==(u=r.maxDepth)&&void 0!==u?u:L),G=Number(null!==(s=r.limit)&&void 0!==s?s:k),U=[],""===p)return["Empty input."];var g=f(p);0===w&&(w=2*(z+2)),O=Math.floor(w/2)+1-w,j=Math.floor(w/2),g=b(g);var v=g.length;if(0===v)return["Empty input."];for(var d=0,M=0;M<=v-1;M++){d=0;for(var m=0;m<=v-1;m++)g[M][0]===g[m][0]&&(d+=g[m][1]);if(d%w!=0)return["Not found."]}var E=0,K=[];for(M=0;M<v-1;M++)g[M][0]in H&&g[M+1][0]in H&&H[g[M][0]].class===H[g[M+1][0]].class&&(K[E]=M,E+=1);var P=Math.pow(2,E),Q=["Not found."],T=!1,V=0;V=0===C?Math.floor((v-1)/3):C;for(var W=1;W<=V;W++){for(M=0;M<=P-1;M++){var X=String(M.toString(2)),Y=g.concat();for(m=0;m<X.length;m++)"1"===X[X.length-1-m]&&(Y=S(Y,K[m],K[m]+1));Q=h(Y,W,W),"Not found."!==Q[0]&&(T=!0)}if(T&&(W===C||0===C))return U.sort(i),0===G?U:U.slice(0,G)}return["Not found."]}function f(r){var n=r;if(n=n.replace(/\s+/giu,""),n=n.replace(/[‘]/gu,"'"),n=n.replace(/[’]/gu,"'"),""===n)return[];for(var e="",t=0;t<n.length;t++)(n[t+1]<"0"||n[t+1]>"9")&&"'"!==n[t+1]?e="".concat(e+n[t]," "):e+=n[t];for(var t in I)for(var a=new RegExp(t,"gu"),c=I[t].replace(/[^a-zA-Z]/gu,"").split(""),o=0,l=c;o<l.length;o++){var u=l[o];e.indexOf(u)>-1&&(e=e.replace(a,I[t]))}var i=e.split(" "),s=[];for(t=0;t<i.length;t++){s[t]=[i[t][0],0];var f=i[t].replace(/[^0-9]/gu,"");s[t][1]=""===f?1:Number(f),s[t][1]>z&&(z=s[t][1]),i[t].indexOf("'")>-1&&(s[t][1]=-s[t][1])}return s}function p(r,n,e){for(var t=0,a=[],c=0;c<r.length-1;c++)r[c][0]in H&&r[c+1][0]in H&&H[r[c][0]].class===H[r[c+1][0]].class&&(a[t]=c,t+=1);var o=Math.pow(2,t),l=["Not found."];for(c=0;c<=o-1;c++){for(var u=String(c.toString(2)),i=r.concat(),s=0;s<u.length;s++)"1"===u[u.length-1-s]&&(i=S(i,a[s],a[s]+1));if(l=h(i,n,e),"Not found."!==l[0])return l}return["Not found."]}function h(r,n,e){var t=b(r),a="",c=t.concat(),o=t.length;if(t.length<3*n+1)return["Not found."];for(var u=0;u<=(o+t.length+1)/2-1;u++)for(var i=1;i<w;i++){var s=(i%2*2-1)*Math.floor((i+1)/2);if(0===u){if(i>1)break}else{if(Math.abs(s)>Math.abs(c[u-1][1]))break;if((w%2==1||c[u-1][1]!==Math.floor(w/2))&&(c[u-1][1]<0&&s>0||c[u-1][1]>0&&s<0))continue}t=d(c,u,s);for(var f=1;f<=t.length/2-1;f++){var h=0;h=1===n?Math.max(1,Math.ceil(t.length/2-f)):1;for(var S=h;S<=t.length/2-1;S++){var N=[],R=[],y=[[]],x=[[]];if(t[f-1][0]===t[f+S-1][0]){for(var L=O;L<=j;L++)if(0!==L){var k=E(t[f+S-1][1]+L);N=b(g(t.slice(0,f),L)),y.push(N),R=b(M(N).concat(g(t.slice(0,f+S),k))),x.push(R)}}else{if(1===n&&t[f][0]!==t[t.length-1][0])continue;N=b(t.slice(0,f)),y.push(N),R=b(t.slice(f,f+S)),x.push(R);var B=[];t[f-1][0]in H&&t[f+S-1][0]in H&&H[t[f+S-1][0]].class===H[t[f-1][0]].class&&t[f+S-1][0]!==t[f-1][0]&&(y.push(N),B=b(R.concat([t[f-1]])),x.push(B),f>=2&&t[f-1][0]in H&&t[f-2][0]in H&&H[t[f-2][0]].class===H[t[f-1][0]].class&&(y.push(N),B=b(R.concat(t.slice(f-2,f))),x.push(B))),t[f][0]in H&&t[f+S][0]in H&&H[t[f+S][0]].class===H[t[f][0]].class&&t[f+S][0]!==t[f][0]&&(B=b(N.concat(M([t[f+S]]))),y.push(B),B=b([t[f+S]].concat(R)),x.push(B),t.length>=f+S+2&&t[f+S][0]in H&&t[f+S+1][0]in H&&H[t[f+S+1][0]].class===H[t[f+S][0]].class&&(B=b(N.concat(M(t.slice(f+S,f+S+2)))),y.push(B),B=b(t.slice(f+S,f+S+2).concat(R)),x.push(B)))}for(var D=1;D<y.length;D++){N=y[D],R=x[D];var F=b(R.concat(N,M(R),M(N),t)),z="";if(n>1)z=p(F,n-1,e)[0];else if(F.length>0)continue;if("Not found."!==z){var A=N,Z=R,q=b(R.concat(N));q.length<Math.max(N.length,R.length)&&(N.length<=R.length?(A=N,Z=q):(A=M(R),Z=q));var C=b(g(c.slice(0,u),s)),G=A,I=Z;if(C.length>0&&1===e){var J=b(C.concat(Z));J.length<C.length-1&&(C=J,G=M(Z),I=A)}var K=m(G),P=m(I),Q=m(C);if(""===K||""===P)continue;var T=v(Q,K,P,z);""===a&&(a=T),l(T)<l(a)&&(a=T),n===e&&-1===U.indexOf(T)&&U.push(T)}}}}}return""===a?["Not found."]:[a]}function g(r,n){var e,t=r.concat();if(0===t.length)return[];var a=null!==(e=t.pop())&&void 0!==e?e:"";return 0===n?t:(t.push([a[0],n]),t)}function v(r,n,e,t){return""===t?A?""===r?"[".concat(n,",").concat(e,"]"):"[".concat(r,":[").concat(n,",").concat(e,"]]"):""===r?"[".concat(n,",").concat(e,"]"):"".concat(r,":[").concat(n,",").concat(e,"]"):A?""===r?"[".concat(n,",").concat(e,"]").concat(t):"[".concat(r,":[").concat(n,",").concat(e,"]").concat(t,"]"):""===r?"[".concat(n,",").concat(e,"]+").concat(t):"".concat(r,":[[").concat(n,",").concat(e,"]+").concat(t,"]")}function d(r,n,e){var t=r.concat(),a=g(t.slice(0,n),e);return b(M(a).concat(t,a))}function M(r){for(var n=[],e=r.length-1;e>=0;e--)n.push([r[e][0],E(-r[e][1])]);return n}function m(r){var n=r.concat();if(n=b(n),0===n.length)return"";for(var e=0;e<=1;e++)for(var t=0;t<n.length-1;t++)n[t][0]in H&&n[t+1][0]in H&&H[n[t][0]].class===H[n[t+1][0]].class&&H[n[t][0]].priority>H[n[t+1][0]].priority&&(n=S(n,t,t+1));var a=[];for(t=0;t<n.length;t++)n[t][1]<0?-1===n[t][1]?a[t]="".concat(n[t][0],"'"):a[t]="".concat(n[t][0]+-n[t][1],"'"):1===n[t][1]?a[t]=n[t][0]:a[t]=n[t][0]+n[t][1];var c="".concat(a.join(" ")," ");for(var t in J){var o=new RegExp("".concat(t," "),"gu");c=c.replace(o,"".concat(J[t]," "))}return c=c.substring(0,c.length-1),c}function b(r){if(0===r.length)return[];for(var n=[],e=0;e<r.length;e++){var t=[r[e][0],E(r[e][1])],a=n.length;if(0!==E(t[1])){for(var c=!1,o=1;o<=3;o++)if(n.length>=o&&n[a-o][0]===t[0]){var l=!0;if(o>=2){for(var u=1;u<=o;u++)if(!(n[a-u][0]in H)){l=!1;break}for(u=2;u<=o;u++){if(!(n[a-u][0]in H&&n[a-(u-1)][0]in H)){l=!1;break}if(H[n[a-u][0]].class!==H[n[a-(u-1)][0]].class){l=!1;break}}}if(l){var i=[n[a-o][0],E(n[a-o][1]+t[1])];0===i[1]?n.splice(-o,1):n.splice(-o,1,i),c=!0;break}}c||(n[a]=t)}}return n}function S(r,n,e){return r[n]=r.splice(e,1,r[n])[0],r}function E(r){return(r%w+w-O)%w+O}var N=4,R=!1,y=2.5,x=5,L=0,k=0,B={U:{class:1,priority:1},D:{class:1,priority:2},E:{class:1,priority:3},R:{class:2,priority:1},L:{class:2,priority:2},M:{class:2,priority:3},F:{class:3,priority:1},B:{class:3,priority:2},S:{class:3,priority:3}},D={r2:"R2 M2","r'":"R' M",r:"R M'",l2:"L2 M2","l'":"L' M'",l:"L M",f2:"F2 S2","f'":"F' S'",f:"F S",b2:"B2 S2","b'":"B' S",b:"B S'",u2:"U2 E2","u'":"U' E",u:"U E'",d2:"D2 E2","d'":"D' E'",d:"D E"},F={"R2 M2":"r2","R' M":"r'","R M'":"r","L2 M2":"l2","L' M'":"l'","L M":"l","F2 S2":"f2","F' S'":"f'","F S":"f","B2 S2":"b2","B' S":"b'","B S'":"b","U2 E2":"u2","U' E":"u'","U E'":"u","D2 E2":"d2","D' E'":"d'","D E":"d","M2 R2":"r2","M R'":"r'","M' R":"r","M2 L2":"l2","M' L'":"l'","M L":"l","S2 F2":"f2","S' F'":"f'","S F":"f","S2 B2":"b2","S B'":"b'","S' B":"b","E2 U2":"u2","E U'":"u'","E' U":"u","E2 D2":"d2","E' D'":"d'","E D":"d","R M2":"r M'","R' M2":"r' M","M2 R":"r M'","M2 R'":"r' M"},U=[],w=N,O=-1,j=2,z=0,A=R,Z=y,q=x,C=L,G=k,H=B,I=D,J=F;return{search:s,expand:r}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=commutator);