/*!
 * Commutator (https://github.com/nbwzx/commutator)
 * Copyright (c) 2022 Zixing Wang <zixingwang.cn@gmail.com>
 * Licensed under MIT (https://github.com/nbwzx/commutator/blob/main/LICENSE)
 */
"use strict";var commutator=function(){function r(r){var t,n,c,u,i=r.algorithm;A=null!==(t=r.order)&&void 0!==t?t:N,T=null!==(n=r.initialReplace)&&void 0!==n?n:O,V=null!==(c=r.finalReplace)&&void 0!==c?c:j,Q=null!==(u=r.commute)&&void 0!==u?u:w,i=i.replace(/[‘]/gu,"'"),i=i.replace(/[’]/gu,"'"),i=i.replace(/\(/gu,""),i=i.replace(/\)/gu,""),i=i.replace(/（/gu,""),i=i.replace(/）/gu,""),i=i.replace(/\s/gu,""),i=i.split("").join(" "),i=i.replace(/【/gu,"["),i=i.replace(/】/gu,"]"),i=i.replace(/：/gu,":"),i=i.replace(/，/gu,","),i=i.replace(/: /gu,":"),i=i.replace(/, /gu,","),i=i.replace(/\[ /gu,"["),i=i.replace(/\] /gu,"]"),i=i.replace(/ :/gu,":"),i=i.replace(/ ,/gu,","),i=i.replace(/ \[/gu,"["),i=i.replace(/ \]/gu,"]"),i="[".concat(i.replace(/\+/gu,"]+["),"]"),i=i.replace(/\]\[/gu,"]+["),0===A?(G=!0,A=R):G=!1,Z=Math.floor(A/2)+1-A,q=Math.floor(A/2);var l=e(a(i));if("Lack left parenthesis."===l[0]||"Lack right parenthesis."===l[0])return l[0];var s=o(l);if(""===s)return"Empty input.";var p=d(f(s));return""===p?"Empty input.":p}function t(r){var t="+:,[]";return t.indexOf(r)>-1}function a(r){for(var a=[r[0]],n=1;n<r.length;n++)t(r[n])||t(a.slice(-1)[0])?a.push(r[n]):a.push(a.pop()+r[n]);return a}function n(r){return","===r?0:":"===r?1:"+"===r?2:"["===r?3:"]"===r?4:-1}function e(r){for(var a=[],e=[],o=!1,c="";r.length>0;){var u=r.shift();if(t(u))if(4===n(u)){for(o=!1;e.length>0;){if(c=e.pop(),"["===c){o=!0;break}a.push(c)}if(!o)return["Lack left parenthesis."]}else{for(;e.length>0&&"["!==e.slice(-1)[0]&&n(u)<=n(e.slice(-1)[0]);)a.push(e.pop());e.push(u)}else a.push(u)}for(;e.length>0;){if(c=e.pop(),"["===c)return["Lack right parenthesis."];a.push(c)}return a}function o(r){for(var a,n=[];r.length>0;){var e=r.shift();if(t(e)){if(!(n.length>=2))return"";var o=n.pop(),u=n.pop();n.push(c(u,o,e))}else n.push(e)}return null!==(a=n[0])&&void 0!==a?a:""}function c(r,t,a){var n=[],e=[];switch(n=f(r),e=f(t),a){case"+":return d(n.concat(e));case":":return d(n.concat(e,b(n)));case",":return d(n.concat(e,b(n),b(e)));default:return d(n.concat(e))}}function u(r){var n=r;n="[".concat(n.replace(/\+/gu,"]+["),"]"),n=n.replace(/\]\[/gu,"]+[");for(var o=e(a(n)),c=[];o.length>0;){var u=o.shift();if(t(u)){var l=c.pop(),s=c.pop(),f=Number(s),p=Number(l);isNaN(f)&&(f=s.split(" ").length),isNaN(p)&&(p=l.split(" ").length),c.push(i(f,p,u).toString())}else c.push(u)}return Number(c[0])}function i(r,t,a){switch(a){case"+":return r+t+K;case":":return r+t;case",":return I*Math.max(r,t)+J*Math.min(r,t);default:return 1/0}}function l(r,t){return u(r)-u(t)}function s(r){var t,a,n,e,o,c,u,i,s,p,v,g=r.algorithm;A=null!==(t=r.order)&&void 0!==t?t:N,H=null!==(a=r.outerBracket)&&void 0!==a?a:x,I=null!==(n=r.abMaxScore)&&void 0!==n?n:L,J=null!==(e=r.abMinScore)&&void 0!==e?e:k,K=null!==(o=r.addScore)&&void 0!==o?o:B,T=null!==(c=r.initialReplace)&&void 0!==c?c:O,V=null!==(u=r.finalReplace)&&void 0!==u?u:j,Q=null!==(i=r.commute)&&void 0!==i?i:w,P=null!==(s=r.fast)&&void 0!==s?s:U;var m=null!==(p=r.maxDepth)&&void 0!==p?p:D,b=null!==(v=r.limit)&&void 0!==v?v:F;if(z=[],""===g)return["Empty input."];var d=f(g);0===A?(G=!0,A=2*(C+2)):G=!1,Z=Math.floor(A/2)+1-A,q=Math.floor(A/2),d=M(d);var y=d.length;if(0===y)return["Empty input."];for(var R=0;R<y;R++){for(var W=0,X=0;X<y;X++)d[R].base===d[X].base&&(W+=d[X].amount);if(W%A!=0)return["Not found."]}var Y=0,$=[];for(R=0;R<y-1;R++)S(d[R],d[R+1])&&($[Y]=R,Y+=1);var _=Math.pow(2,Y),rr=["Not found."],tr=!1,ar=0;ar=0===m?Math.floor((y-1)/3):m;for(var nr=1;nr<=ar;nr++){for(R=0;R<_;R++){var er=String(R.toString(2)),or=d.concat();for(X=0;X<er.length;X++)"1"===er[er.length-1-X]&&(or=E(or,$[X],$[X]+1));if(rr=h(or,nr,nr),"Not found."!==rr[0]&&(tr=!0),P&&tr)return z}if(tr&&(nr===m||0===m))return z.sort(l),0===b?z:z.slice(0,b)}return["Not found."]}function f(r){var t=r;if(t=t.replace(/\s+/giu,""),t=t.replace(/[‘]/gu,"'"),t=t.replace(/[’]/gu,"'"),""===t)return[];for(var a="",n=0;n<t.length;n++)(t[n+1]<"0"||t[n+1]>"9")&&"'"!==t[n+1]?a="".concat(a+t[n]," "):a+=t[n];for(var n in T)for(var e=new RegExp(n,"gu"),o=T[n].replace(/[^a-zA-Z]/gu,"").split(""),c=0,u=o;c<u.length;c++){var i=u[c];a.indexOf(i)>-1&&(a=a.replace(e,T[n]))}var l=a.split(" "),s=[];for(n=0;n<l.length;n++){s[n]={base:l[n][0],amount:0};var f=l[n].replace(/[^0-9]/gu,"");s[n].amount=""===f?1:Number(f),s[n].amount>C&&(C=s[n].amount),l[n].indexOf("'")>-1&&(s[n].amount=-s[n].amount)}return s}function p(r,t,a){for(var n=0,e=[],o=0;o<r.length-1;o++)S(r[o],r[o+1])&&(e[n]=o,n+=1);var c=Math.pow(2,n),u=["Not found."];for(o=0;o<c;o++){for(var i=String(o.toString(2)),l=r.concat(),s=0;s<i.length;s++)"1"===i[i.length-1-s]&&(l=E(l,e[s],e[s]+1));if(u=h(l,t,a),"Not found."!==u[0])return u}return["Not found."]}function h(r,t,a){var n=M(r),e="",o=n.concat(),c=n.length;if(n.length<3*t+1)return["Not found."];for(var i=0;i<=(c+n.length+1)/2-1;i++)for(var l=1;l<A;l++){var s=(l%2*2-1)*Math.floor((l+1)/2);if(0===i){if(l>1)break}else{if(Math.abs(s)>Math.abs(o[i-1].amount))break;if((A%2==1||o[i-1].amount!==Math.floor(A/2))&&(o[i-1].amount<0&&s>0||o[i-1].amount>0&&s<0))continue}n=m(o,i,s);for(var f=1;f<=n.length/2-1;f++){var h=0;h=1===t?Math.max(1,Math.ceil(n.length/2-f)):1;for(var E=h;E<=n.length/2-1;E++){var R=[],N=[],x=[[]],L=[[]];if(n[f-1].base===n[f+E-1].base){for(var k=Z;k<=q;k++)if(0!==k){var B=y(n[f+E-1].amount+k);R=M(v(n.slice(0,f),k)),x.push(R),N=M(b(R).concat(v(n.slice(0,f+E),B))),L.push(N)}}else{if(1===t&&n[f].base!==n[n.length-1].base)continue;R=M(n.slice(0,f)),x.push(R),N=M(n.slice(f,f+E)),L.push(N);var D=[];S(n[f-1],n[f+E-1])&&(x.push(R),D=M(N.concat([n[f-1]])),L.push(D),f>=2&&S(n[f-1],n[f-2])&&(x.push(R),D=M(N.concat(n.slice(f-2,f))),L.push(D))),S(n[f],n[f+E])&&(D=M(R.concat(b([n[f+E]]))),x.push(D),D=M([n[f+E]].concat(N)),L.push(D),n.length>=f+E+2&&S(n[f+E],n[f+E+1])&&(D=M(R.concat(b(n.slice(f+E,f+E+2)))),x.push(D),D=M(n.slice(f+E,f+E+2).concat(N)),L.push(D)))}for(var F=1;F<x.length;F++){R=x[F],N=L[F];var U=M(N.concat(R,b(N),b(R),n)),w="";if(t>1)w=p(U,t-1,a)[0];else if(U.length>0)continue;if("Not found."!==w){var O=R,j=N,C=M(N.concat(R));C.length<Math.max(R.length,N.length)&&(R.length<=N.length?(O=R,j=C):(O=b(N),j=C));var G=M(v(o.slice(0,i),s)),H=O,I=j;if(G.length>0&&1===a){var J=M(G.concat(j));J.length<G.length-1&&(G=J,H=b(j),I=O)}var K=d(H),Q=d(I),T=d(G);if(""===K||""===Q)continue;var V=g(T,K,Q,w);if(""===e&&(e=V),u(V)<u(e)&&(e=V),t===a&&-1===z.indexOf(V)&&z.push(V),P)return[e]}}}}}return""===e?["Not found."]:[e]}function v(r,t){var a=r.concat();if(0===a.length)return[];var n=a.pop();return 0===t?a:(a.push({base:n.base,amount:t}),a)}function g(r,t,a,n){return""===n?H?""===r?"[".concat(t,",").concat(a,"]"):"[".concat(r,":[").concat(t,",").concat(a,"]]"):""===r?"[".concat(t,",").concat(a,"]"):"".concat(r,":[").concat(t,",").concat(a,"]"):H?""===r?"[".concat(t,",").concat(a,"]").concat(n):"[".concat(r,":[").concat(t,",").concat(a,"]").concat(n,"]"):""===r?"[".concat(t,",").concat(a,"]+").concat(n):"".concat(r,":[[").concat(t,",").concat(a,"]+").concat(n,"]")}function m(r,t,a){var n=r.concat(),e=v(n.slice(0,t),a);return M(b(e).concat(n,e))}function b(r){for(var t=[],a=r.length-1;a>=0;a--)t.push({base:r[a].base,amount:y(-r[a].amount)});return t}function d(r){var t=r.concat();if(t=M(t),0===t.length)return"";for(var a=0;a<=1;a++)for(var n=0;n<t.length-1;n++)S(t[n],t[n+1])&&Q[t[n].base].priority>Q[t[n+1].base].priority&&(t=E(t,n,n+1));var e=[];for(n=0;n<t.length;n++)t[n].amount<0?-1===t[n].amount?e[n]="".concat(t[n].base,"'"):e[n]="".concat(t[n].base+-t[n].amount,"'"):1===t[n].amount?e[n]=t[n].base:e[n]=t[n].base+t[n].amount;var o="".concat(e.join(" ")," ");for(var n in V){var c=new RegExp("".concat(n," "),"gu");o=o.replace(c,"".concat(V[n]," "))}return o=o.substring(0,o.length-1),o}function M(r){if(0===r.length)return[];for(var t=[],a=0;a<r.length;a++){var n={base:r[a].base,amount:y(r[a].amount)},e=t.length;if(0!==y(n.amount)){for(var o=!1,c=1;c<=3;c++)if(t.length>=c&&t[e-c].base===n.base){var u=!0;if(c>=2){for(var i=1;i<=c;i++)if(!(t[e-i].base in Q)){u=!1;break}for(i=2;i<=c;i++)if(!S(t[e-i],t[e-(i-1)])){u=!1;break}}if(u){var l={base:t[e-c].base,amount:y(t[e-c].amount+n.amount)};0===l.amount?t.splice(-c,1):t.splice(-c,1,l),o=!0;break}}o||(t[e]=n)}}return t}function S(r,t){return r.base in Q&&t.base in Q&&Q[r.base].class===Q[t.base].class}function E(r,t,a){return r[t]=r.splice(a,1,r[t])[0],r}function y(r){return G?r:(r%A+A-Z)%A+Z}var R=4294967295,N=4,x=!1,L=2.5,k=5,B=1,D=0,F=0,U=!1,w={U:{class:1,priority:1},u:{class:1,priority:2},E:{class:1,priority:3},D:{class:1,priority:4},d:{class:1,priority:5},R:{class:2,priority:1},r:{class:2,priority:2},M:{class:2,priority:3},L:{class:2,priority:4},l:{class:2,priority:5},F:{class:3,priority:1},f:{class:3,priority:2},S:{class:3,priority:3},B:{class:3,priority:4},b:{class:3,priority:5}},O={r2:"R2 M2","r'":"R' M",r:"R M'",l2:"M2 L2","l'":"M' L'",l:"M L",f2:"F2 S2","f'":"F' S'",f:"F S",b2:"S2 B2","b'":"S B'",b:"S' B",u2:"U2 E2","u'":"U' E",u:"U E'",d2:"E2 D2","d'":"E' D'",d:"E D"},j={"R2 M2":"r2","R' M":"r'","R M'":"r","M2 L2":"l2","M' L'":"l'","M L":"l","F2 S2":"f2","F' S'":"f'","F S":"f","S2 B2":"b2","S B'":"b'","S' B":"b","U2 E2":"u2","U' E":"u'","U E'":"u","E2 D2":"d2","E' D'":"d'","E D":"d","M2 R2":"r2","M R'":"r'","M' R":"r","L2 M2":"l2","L' M'":"l'","L M":"l","S2 F2":"f2","S' F'":"f'","S F":"f","B2 S2":"b2","B' S":"b'","B S'":"b","E2 U2":"u2","E U'":"u'","E' U":"u","D2 E2":"d2","D' E'":"d'","D E":"d","R M2":"r M'","R' M2":"r' M","M2 R":"r M'","M2 R'":"r' M"},z=[],A=N,Z=Math.floor(N/2)+1-N,q=Math.floor(N/2),C=0,G=!1,H=x,I=L,J=k,K=B,P=!1,Q=w,T=O,V=j;return{search:s,expand:r}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=commutator);