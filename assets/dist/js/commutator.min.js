/*!
 * Commutator (https://github.com/nbwzx/commutator)
 * Copyright (c) 2022 Zixing Wang <zixingwang.cn@gmail.com>
 * Licensed under MIT (https://github.com/nbwzx/commutator/blob/main/LICENSE)
 */
"use strict";var commutator=function(){function r(r){var t,n,c,u,l=r.algorithm;Z=null!==(t=r.order)&&void 0!==t?t:R,T=null!==(n=r.initialReplace)&&void 0!==n?n:O,V=null!==(c=r.finalReplace)&&void 0!==c?c:j,Q=null!==(u=r.commute)&&void 0!==u?u:w,l=l.replace(/[‘]/gu,"'"),l=l.replace(/[’]/gu,"'"),l=l.replace(/\(/gu,""),l=l.replace(/\)/gu,""),l=l.replace(/（/gu,""),l=l.replace(/）/gu,""),l=l.replace(/\s/gu,""),l=l.split("").join(" "),l=l.replace(/【/gu,"["),l=l.replace(/】/gu,"]"),l=l.replace(/：/gu,":"),l=l.replace(/，/gu,","),l=l.replace(/: /gu,":"),l=l.replace(/, /gu,","),l=l.replace(/\[ /gu,"["),l=l.replace(/\] /gu,"]"),l=l.replace(/ :/gu,":"),l=l.replace(/ ,/gu,","),l=l.replace(/ \[/gu,"["),l=l.replace(/ \]/gu,"]"),l="[".concat(l.replace(/\+/gu,"]+["),"]"),l=l.replace(/\]\[/gu,"]+["),0===Z?(G=!0,Z=y):G=!1,z=Math.floor(Z/2)+1-Z,C=Math.floor(Z/2);var i=e(a(l));if("Lack left parenthesis."===i[0]||"Lack right parenthesis."===i[0])return i[0];var s=o(i);if(""===s)return"Empty input.";var p=d(f(s));return""===p?"Empty input.":p}function t(r){var t="+:,[]";return t.indexOf(r)>-1}function a(r){for(var a=[r[0]],n=1;n<r.length;n++)t(r[n])||t(a.slice(-1)[0])?a.push(r[n]):a.push(a.pop()+r[n]);return a}function n(r){return","===r?0:":"===r?1:"+"===r?2:"["===r?3:"]"===r?4:-1}function e(r){for(var a=[],e=[],o=!1,c="";r.length>0;){var u=r.shift();if(t(u))if(4===n(u)){for(o=!1;e.length>0;){if(c=e.pop(),"["===c){o=!0;break}a.push(c)}if(!o)return["Lack left parenthesis."]}else{for(;e.length>0&&"["!==e.slice(-1)[0]&&n(u)<=n(e.slice(-1)[0]);)a.push(e.pop());e.push(u)}else a.push(u)}for(;e.length>0;){if(c=e.pop(),"["===c)return["Lack right parenthesis."];a.push(c)}return a}function o(r){for(var a,n=[];r.length>0;){var e=r.shift();if(t(e)){if(!(n.length>=2))return"";var o=n.pop(),u=n.pop();n.push(c(u,o,e))}else n.push(e)}return null!==(a=n[0])&&void 0!==a?a:""}function c(r,t,a){var n=[],e=[];switch(n=f(r),e=f(t),a){case"+":return d(n.concat(e));case":":return d(n.concat(e,m(n)));case",":return d(n.concat(e,m(n),m(e)));default:return d(n.concat(e))}}function u(r){var n=r;n="[".concat(n.replace(/\+/gu,"]+["),"]"),n=n.replace(/\]\[/gu,"]+[");for(var o=e(a(n)),c=[];o.length>0;){var u=o.shift();if(t(u)){var i=c.pop(),s=c.pop(),f=Number(s),p=Number(i);isNaN(f)&&(f=s.split(" ").length),isNaN(p)&&(p=i.split(" ").length),c.push(l(f,p,u).toString())}else c.push(u)}return Number(c[0])}function l(r,t,a){switch(a){case"+":return r+t+K;case":":return r+t;case",":return I*Math.max(r,t)+J*Math.min(r,t);default:return 1/0}}function i(r,t){return u(r)-u(t)}function s(r){var t,a,n,e,o,c,u,l,s,p,g,v=r.algorithm;Z=null!==(t=r.order)&&void 0!==t?t:R,H=null!==(a=r.outerBracket)&&void 0!==a?a:N,I=null!==(n=r.abMaxScore)&&void 0!==n?n:L,J=null!==(e=r.abMinScore)&&void 0!==e?e:x,K=null!==(o=r.addScore)&&void 0!==o?o:k,T=null!==(c=r.initialReplace)&&void 0!==c?c:O,V=null!==(u=r.finalReplace)&&void 0!==u?u:j,Q=null!==(l=r.commute)&&void 0!==l?l:w,P=null!==(s=r.fast)&&void 0!==s?s:F;var b=null!==(p=r.maxDepth)&&void 0!==p?p:B,m=null!==(g=r.limit)&&void 0!==g?g:D;if(A=[],""===v)return["Empty input."];var d=f(v);0===Z?(G=!0,Z=2*(q+2)):G=!1,z=Math.floor(Z/2)+1-Z,C=Math.floor(Z/2),d=M(d);var U=d.length;if(0===U)return["Empty input."];for(var y=0;y<U;y++){for(var W=0,X=0;X<U;X++)d[y].base===d[X].base&&(W+=d[X].amount);if(W%Z!=0)return["Not found."]}var Y=0,$=[];for(y=0;y<U-1;y++)E(d[y],d[y+1])&&($[Y]=y,Y+=1);var _=Math.pow(2,Y),rr=["Not found."],tr=!1,ar=0;ar=0===b?Math.floor((U-1)/3):b;for(var nr=1;nr<=ar;nr++){for(y=0;y<_;y++){var er=String(y.toString(2)),or=d.concat();for(X=0;X<er.length;X++)"1"===er[er.length-1-X]&&(or=S(or,$[X],$[X]+1));if(rr=h(or,nr,nr),"Not found."!==rr[0]&&(tr=!0),P&&tr)return A}if(tr&&(nr===b||0===b))return A.sort(i),0===m?A:A.slice(0,m)}return["Not found."]}function f(r){var t=r;if(t=t.replace(/\s+/giu,""),t=t.replace(/[‘]/gu,"'"),t=t.replace(/[’]/gu,"'"),""===t)return[];Object.keys(T).length>0&&(t=t.replace(/[A-Z]w/gu,function(r){return r.charAt(0).toLowerCase()}));for(var a="",n=0;n<t.length;n++)(t[n+1]<"0"||t[n+1]>"9")&&"'"!==t[n+1]?a="".concat(a+t[n]," "):a+=t[n];for(var n in T)for(var e=new RegExp(n,"gu"),o=T[n].replace(/[^a-zA-Z]/gu,"").split(""),c=0,u=o;c<u.length;c++){var l=u[c];a.indexOf(l)>-1&&(a=a.replace(e,T[n]))}var i=a.split(" "),s=[];for(n=0;n<i.length;n++){s[n]={base:i[n][0],amount:0};var f=i[n].replace(/[^0-9]/gu,"");s[n].amount=""===f?1:Number(f),s[n].amount>q&&(q=s[n].amount),i[n].indexOf("'")>-1&&(s[n].amount=-s[n].amount)}return s}function p(r,t,a){for(var n=0,e=[],o=0;o<r.length-1;o++)E(r[o],r[o+1])&&(e[n]=o,n+=1);var c=Math.pow(2,n),u=["Not found."];for(o=0;o<c;o++){for(var l=String(o.toString(2)),i=r.concat(),s=0;s<l.length;s++)"1"===l[l.length-1-s]&&(i=S(i,e[s],e[s]+1));if(u=h(i,t,a),"Not found."!==u[0])return u}return["Not found."]}function h(r,t,a){var n=M(r),e="",o=n.concat(),c=n.length;if(n.length<3*t+1)return["Not found."];for(var l=0;l<=(c+n.length+1)/2-1;l++)for(var i=1;i<Z;i++){var s=(i%2*2-1)*Math.floor((i+1)/2);if(0===l){if(i>1)break}else{if(Math.abs(s)>Math.abs(o[l-1].amount))break;if((Z%2==1||o[l-1].amount!==Math.floor(Z/2))&&(o[l-1].amount<0&&s>0||o[l-1].amount>0&&s<0))continue}n=b(o,l,s);for(var f=1;f<=n.length/2-1;f++){var h=0;h=1===t?Math.max(1,Math.ceil(n.length/2-f)):1;for(var S=h;S<=n.length/2-1;S++){var y=[],R=[],N=[[]],L=[[]];if(n[f-1].base===n[f+S-1].base){for(var x=z;x<=C;x++)if(0!==x){var k=U(n[f+S-1].amount+x);y=M(g(n.slice(0,f),x)),N.push(y),R=M(m(y).concat(g(n.slice(0,f+S),k))),L.push(R)}}else{if(1===t&&n[f].base!==n[n.length-1].base)continue;y=M(n.slice(0,f)),N.push(y),R=M(n.slice(f,f+S)),L.push(R);var B=[];E(n[f-1],n[f+S-1])&&(N.push(y),B=M(R.concat([n[f-1]])),L.push(B),f>=2&&E(n[f-1],n[f-2])&&(N.push(y),B=M(R.concat(n.slice(f-2,f))),L.push(B))),E(n[f],n[f+S])&&(B=M(y.concat(m([n[f+S]]))),N.push(B),B=M([n[f+S]].concat(R)),L.push(B),n.length>=f+S+2&&E(n[f+S],n[f+S+1])&&(B=M(y.concat(m(n.slice(f+S,f+S+2)))),N.push(B),B=M(n.slice(f+S,f+S+2).concat(R)),L.push(B)))}for(var D=1;D<N.length;D++){y=N[D],R=L[D];var F=M(R.concat(y,m(R),m(y),n)),w="";if(t>1)w=p(F,t-1,a)[0];else if(F.length>0)continue;if("Not found."!==w){var O=y,j=R,q=M(R.concat(y));q.length<Math.max(y.length,R.length)&&(y.length<=R.length?(O=y,j=q):(O=m(R),j=q));var G=M(g(o.slice(0,l),s)),H=O,I=j;if(G.length>0&&1===a){var J=M(G.concat(j));J.length<G.length-1&&(G=J,H=m(j),I=O)}var K=d(H),Q=d(I),T=d(G);if(""===K||""===Q)continue;var V=v(T,K,Q,w);if(""===e&&(e=V),u(V)<u(e)&&(e=V),t===a&&-1===A.indexOf(V)&&A.push(V),P)return[e]}}}}}return""===e?["Not found."]:[e]}function g(r,t){var a=r.concat();if(0===a.length)return[];var n=a.pop();return 0===t?a:(a.push({base:n.base,amount:t}),a)}function v(r,t,a,n){return""===n?H?""===r?"[".concat(t,",").concat(a,"]"):"[".concat(r,":[").concat(t,",").concat(a,"]]"):""===r?"[".concat(t,",").concat(a,"]"):"".concat(r,":[").concat(t,",").concat(a,"]"):H?""===r?"[".concat(t,",").concat(a,"]").concat(n):"[".concat(r,":[").concat(t,",").concat(a,"]").concat(n,"]"):""===r?"[".concat(t,",").concat(a,"]+").concat(n):"".concat(r,":[[").concat(t,",").concat(a,"]+").concat(n,"]")}function b(r,t,a){var n=r.concat(),e=g(n.slice(0,t),a);return M(m(e).concat(n,e))}function m(r){for(var t=[],a=r.length-1;a>=0;a--)t.push({base:r[a].base,amount:U(-r[a].amount)});return t}function d(r){var t=r.concat();if(t=M(t),0===t.length)return"";for(var a=0;a<=1;a++)for(var n=0;n<t.length-1;n++)E(t[n],t[n+1])&&Q[t[n].base].priority>Q[t[n+1].base].priority&&(t=S(t,n,n+1));var e=[];for(n=0;n<t.length;n++)t[n].amount<0?-1===t[n].amount?e[n]="".concat(t[n].base,"'"):e[n]="".concat(t[n].base+-t[n].amount,"'"):1===t[n].amount?e[n]=t[n].base:e[n]=t[n].base+t[n].amount;var o="".concat(e.join(" ")," ");for(var n in V){var c=new RegExp("".concat(n," "),"gu");o=o.replace(c,"".concat(V[n]," "))}return o=o.substring(0,o.length-1),o}function M(r){if(0===r.length)return[];for(var t=[],a=0;a<r.length;a++){var n={base:r[a].base,amount:U(r[a].amount)},e=t.length;if(0!==U(n.amount)){for(var o=!1,c=1;c<=3;c++)if(t.length>=c&&t[e-c].base===n.base){var u=!0;if(c>=2){for(var l=1;l<=c;l++)if(!(t[e-l].base in Q)){u=!1;break}for(l=2;l<=c;l++)if(!E(t[e-l],t[e-(l-1)])){u=!1;break}}if(u){var i={base:t[e-c].base,amount:U(t[e-c].amount+n.amount)};0===i.amount?t.splice(-c,1):t.splice(-c,1,i),o=!0;break}}o||(t[e]=n)}}return t}function E(r,t){return r.base in Q&&t.base in Q&&Q[r.base].class===Q[t.base].class}function S(r,t,a){return r[t]=r.splice(a,1,r[t])[0],r}function U(r){return G?r:(r%Z+Z-z)%Z+z}var y=4294967295,R=4,N=!1,L=2.5,x=5,k=1,B=0,D=0,F=!1,w={U:{class:1,priority:1},u:{class:1,priority:2},E:{class:1,priority:3},D:{class:1,priority:4},d:{class:1,priority:5},R:{class:2,priority:1},r:{class:2,priority:2},M:{class:2,priority:3},L:{class:2,priority:4},l:{class:2,priority:5},F:{class:3,priority:1},f:{class:3,priority:2},S:{class:3,priority:3},B:{class:3,priority:4},b:{class:3,priority:5}},O={r2:"R2 M2","r'":"R' M",r:"R M'",l2:"M2 L2","l'":"M' L'",l:"M L",f2:"F2 S2","f'":"F' S'",f:"F S",b2:"S2 B2","b'":"S B'",b:"S' B",u2:"U2 E2","u'":"U' E",u:"U E'",d2:"E2 D2","d'":"E' D'",d:"E D"},j={"R2 M2":"r2","R' M":"r'","R M'":"r","M2 L2":"l2","M' L'":"l'","M L":"l","F2 S2":"f2","F' S'":"f'","F S":"f","S2 B2":"b2","S B'":"b'","S' B":"b","U2 E2":"u2","U' E":"u'","U E'":"u","E2 D2":"d2","E' D'":"d'","E D":"d","M2 R2":"r2","M R'":"r'","M' R":"r","L2 M2":"l2","L' M'":"l'","L M":"l","S2 F2":"f2","S' F'":"f'","S F":"f","B2 S2":"b2","B' S":"b'","B S'":"b","E2 U2":"u2","E U'":"u'","E' U":"u","D2 E2":"d2","D' E'":"d'","D E":"d","R M2":"r M'","R' M2":"r' M","M2 R":"r M'","M2 R'":"r' M","U2 E":"U' u'","U2 E'":"U u","E U2":"U' u'","E' U2":"U u","U E2":"U' u2","U' E2":"U u2","E2 U":"U' u2","E2 U'":"U u2"},A=[],Z=R,z=Math.floor(R/2)+1-R,C=Math.floor(R/2),q=0,G=!1,H=N,I=L,J=x,K=k,P=!1,Q=w,T=O,V=j;return{search:s,expand:r}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=commutator);